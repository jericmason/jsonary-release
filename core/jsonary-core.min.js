!function(){"undefined"!=typeof window&&"undefined"==typeof localStorage&&(window.localStorage={}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0;n<this.length;n++)if(this[n]===e)return n;return-1}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Date.prototype.toISOString||function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),Object.create||(Object.create=function(){function e(){}return function(t){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,a,s,o=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(a=u.length,n=0;a>n;n+=1)s[n]=str(n,u)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,i}if(rep&&"object"==typeof rep)for(a=rep.length,n=0;a>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,u),i&&s.push(quote(r)+(gap?": ":":")+i));else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(i=str(r,u),i&&s.push(quote(r)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e){function t(e){var t=e.match(/^[a-zA-Z\-]+:/);null!=t&&t.length>0?(this.scheme=t[0].substring(0,t[0].length-1),e=e.substring(t[0].length)):this.scheme=null,"//"==e.substring(0,2)?(this.doubleSlash=!0,e=e.substring(2)):this.doubleSlash=!1;var i=e.indexOf("#");if(i>=0){var a=e.substring(i+1);this.fragment=r(a),e=e.substring(0,i)}else this.hash=null;var s=e.indexOf("?");if(s>=0){var o=e.substring(s+1);this.query=n(o),e=e.substring(0,s)}else this.query=null;var u=e.indexOf("@");if(u>=0){var h=e.substring(0,u),l=h.indexOf(":");-1==l?(this.username=h,this.password=null):(this.username=h.substring(0,l),this.password=h.substring(l+1));var e=e.substring(u+1)}else this.username=null,this.password=null;var c=0;(null!=this.scheme||this.doubleSlash)&&(c=e.indexOf("/")),c>=0?(this.path=e.substring(c),""==this.path&&(this.path=null),e=e.substring(0,c)):this.path=null;var l=e.indexOf(":");l>=0?(this.port=e.substring(l+1),e=e.substring(0,l)):this.port=null,this.domain=""==e?null:e}function n(e){for(var t=e.split("&"),n=[],r=0;r<t.length;r++){var i=t[r],a=i.indexOf("=");if(-1==a)n.push({key:i});else{var s=i.substring(0,a),o=i.substring(a+1);n.push({key:s,value:decodeURIComponent(o)})}}for(var s in q)n[s]=q[s];var u=JSON.stringify(n);return n.toString=function(){return JSON.stringify(this)==u?e:q.toString.call(this)},n.isQuery=!0,n}function r(e){return-1==e.indexOf("?")?n(e):(e.isQuery=!1,void 0)}function i(e,t){for(var n in t)!function(t,n){e[t]=function(){return n}}(n,t[n])}function a(e){function t(){return n.done=!0,n.result=function(){throw Error("More results than expected in ResultCollector")},s.call(this,r),n}if(!(this instanceof a))return new a(e);e=e||function(e){return e};var n=this;this.done=!1;var r={},i=0,s=null;this.whenDone=function(e){return s=e,0===i&&t(),this},this.wait=function(){return i++,this},this.result=function(){i--;var n=e.apply(this,arguments);return s&&0===i&&t(),n},this.forKey=function(e){return function(){var t=s;s=null;var i=r[e]=n.result.apply(this,arguments);return n.whenDone(t),i}}}function s(e){this.contents={},this.keyOrder=[],this.context=e}function o(e){this.listeners=[],this.context=e}function u(e,t){var n=this;this.baseUrl=e.url,this.fragment=t,this.document=e.document,null==t&&(t=""),this.url=this.baseUrl+"#"+encodeURI(t),this.getRoot=function(t){return e.getRoot(function(e){t.call(e,e,n)}),this},this.getData=function(r){return null==t||""==t?e.document.getRoot(function(e){r.call(e,e,n)}):e.document.getFragment(t,function(e){r.call(e,e,n)}),this},this.getRawResponse=function(t){return e.getResponse(function(e){t.call(e,e,n)}),this}}function h(t,n,r,i,a,s,o){var h={};if(o)for(var l in o)h[l.toLowerCase()]=o[l];if(void 0==t)throw new Error("URL cannot be undefined");t=_.resolveRelativeUri(t),void 0==n&&(n="GET"),void 0===r&&(r={});var c=null,f=t.indexOf("#");f>=0&&(c=decodeURI(t.substring(f+1)),t=t.substring(0,f)),void 0==i&&(i="GET"==n?"application/x-www-form-urlencoded":"POST"==n||"PUT"==n?"application/json":"application/x-www-form-urlencoded"),void 0==a&&(a=e.defaultCache),"GET"==n&&(r=J.encodeData(r,i),""!=r&&(t.indexOf("?")==t.length-1||(t+=-1==t.indexOf("?")?"?":"&"),t+=r),r={});var p=a&&"GET"==n&&"application/x-www-form-urlencoded"==i&&!/^data:/.test(t);if(p){var m=JSON.stringify(t)+":"+JSON.stringify(r),v=a(m);if(void 0!=v)return{request:v,fragmentRequest:new u(v,c)}}var g=new d(t,n,r,i,s,h,function(e){p&&a(m,e)});return{request:g,fragmentRequest:new u(g,c)}}function l(t,n,r,i){t=_.resolveRelativeUri(t),void 0==i&&(i=e.defaultCache);var a={},s=JSON.stringify(t)+":"+JSON.stringify(a);new f(t,n,r,i,s)}function c(e){this.httpCode=e,this.message="HTTP Status: "+e}function d(e,t,n,r,i,a,s){s(this),e=_.resolveRelativeUri(e),n="GET"==t||"DELETE"==t?null:_.encodeData(n,r),_.log(_.logLevel.STANDARD,"Sending request for: "+e),this.successful=null,this.error=null,this.url=e;var u=void 0==n||""==n;this.responseListeners=new o(this),this.document=new v(e,u,!0),this.fetched=!1,this.fetchData(e,t,n,r,i,a),this.invalidate=function(){var s=function(){null!=o.successful&&"GET"==t&&o.fetchData(e,t,n,r,i,a)},o=this;this.document.whenAccessed(s),this.document.whenStable=function(e){return delete o.document.whenStable,s(),o.document.whenStable(e)}}}function f(e,t,n,r,i){r(i,this);var a=this;this.url=e,this.responseListeners=new o(this),this.document=new v(e,!0,!0),this.document.setRaw(t),this.profileUrl=n,void 0!=n&&this.document.raw.addSchema(n),e==n?this.document.setRoot(""):this.document.raw.whenSchemasStable(function(){var e=a.document.raw.getLink("root");if(void 0!=e){var t=decodeURI(e.href.substring(e.href.indexOf("#")+1));a.document.setRoot(t)}else a.document.setRoot("")}),this.successful=!0,this.error=null,this.fetched=!1,this.invalidate=function(){this.fetchData(e,"GET",void 0,"application/x-www-form-urlencoded",n)}}function p(e){this.operations=[],void 0==e&&(e=""),this.prefix=e}function m(e,t,n){this._patchType=e,this._subject=t,this._subjectValue=void 0,"move"==e?this._target=n:this._value=n}function v(t,n,r){function i(e){B.increment();var t=W.concat(h);B.add(function(){for(var n=0;n<t.length;n++)t[n].call(a,e,a)}),B.decrement()}var a=this;this.readOnly=!!r,this.isDefinitive=!!n,this.url=t,this.http={error:null};var s=null;this.rootPath=function(){return s};var u={};this.raw=new y(this,u),this.uniqueId=this.raw.uniqueId,this.root=null;var h=[];this.registerChangeListener=function(e){h.push(e)};var l=[];this.access=function(){for(;l.length;)l.shift().call(this)},this.whenAccessed=function(t){e.config.accessImmediately?t.call(this):l.push(t)},this.setRaw=function(e){var t=this.raw.defined();if(u.setValue(e),t){u.setValue(e);var n=new p;n.replace(this.raw.pointerPath(),e),i(n)}};var c=new o(this);this.getRoot=function(e){null==this.root?c.add(e):e.call(this,this.root)},this.setRoot=function(e){s=e,this.root=this.raw.subPath(e),c.notify(this.root)},this.patch=function(e){if(this.access(),this.readOnly)throw new Error("Cannot update read-only document");if(X)return void 0==this.batchPatch&&(this.batchPatch=new p,Q.push(this)),this.batchPatch.operations=this.batchPatch.operations.concat(e.operations),void 0;B.increment();var t=e.filter("?"),n=e.filterRemainder("?");this.raw.patch(t),this.root.patch(n),i(e),B.decrement()},this.affectedData=function(e){var t=e.subject(),n=null;n="?"==t||"?/"==t.substring(0,2)?this.raw.subPath(t.substring(1)):this.root.subPath(t);for(var r=[];void 0!=n;)r.push(n),n=n.parent();if("move"==e.action()){var i=e.target(),a=null;for(a="?"==i||"?/"==i.substring(0,2)?this.raw.subPath(i.substring(1)):this.root.subPath(i),r.push();void 0!=a;)r.push(a),a=a.parent()}return r};var d=(this.url||"").split("#")[0],f={};this.addSelfLink=function(e){var t=e.rawLink.href;if(t.substring(0,d.length+1)==d+"#"){var n=decodeURIComponent(t.substring(d.length+1));f[n]=e.dataObj}},this.removeSelfLink=function(e){var t=e.rawLink.href;if(t.substring(0,d.length+1)==d+"#"){var n=decodeURIComponent(t.substring(d.length+1));f[n]==e.dataObj&&delete f[n]}},this.getFragment=function(e,t){return void 0!==f[e]?(t.call(this,f[e]),void 0):(this.getRoot(function(n){if(""==e)t.call(this,n);else{var r=n.subPath(e);t.call(this,r)}}),void 0)}}function g(e){return Y.test(e)}function y(e,t,n,r){this.uniqueId=z++,this.document=e,this.readOnly=function(t){return t||void 0===t?e.readOnly||this.schemas().readOnly()||void 0!=n&&n.readOnly(!0):e.readOnly};var i=void 0,a=void 0,s=0,o=[],u={},h={};this.property=function(e){return void 0==u[e]&&(h[e]={},u[e]=new y(this.document,h[e],this,e),"object"==a&&(h[e].setValue(i[e]),void 0!==i[e]&&t.schemas.addSchemasForProperty(e,u[e]))),u[e]};var l={},c={};this.item=function(e){if(!g(e))throw new Error("Index must be a positive integer (or integer-value string)");return void 0==l[e]&&(c[e]={},l[e]=new y(this.document,c[e],this,e),"array"==a&&(c[e].setValue(i[e]),void 0!==i[e]&&t.schemas.addSchemasForIndex(e,l[e]))),l[e]},this.parent=function(){return n},this.parentKey=function(){return r},this.pointerPath=function(){return this.document.root==this?"":void 0!=n?n.pointerPath()+"/"+_.encodePointerComponent(r):"?"},this.basicType=function(){return e.access(),a},this.value=function(){if(e.access(),"object"==a){for(var t={},n=0;n<o.length;n++){var r=o[n];t[r]=void 0!=u[r]?u[r].value():i[r]}return t}if("array"==a){for(var t=[],n=0;s>n;n++)t[n]=void 0!=l[n]?l[n].value():i[n];return t}return i},this.keys=function(){return e.access(),o.slice(0)},this.length=function(){return e.access(),s},this.patch=function(e){var r=this,d=this.pointerPath(),f={};if(e.each(function(e,p){if(p.subjectEquals(d)){if("replace"==p.action()||"add"==p.action())p.setSubjectValue(r.value()),t.setValue(p.value());else if("remove"==p.action())n||t.setValue(void 0);else if("move"!=p.action())throw new Error("Unrecognised patch operation: "+p.action())}else if(p.targetEquals(d))"move"==p.action()&&t.setValue(p.subjectValue());else{var m=p.subjectChild(d);if("string"==typeof m)if(f[m]=!0,"object"==a){if("add"==p.action()){var v=o.indexOf(m);if(-1!=v)throw new Error("Cannot add existing key: "+m);o.push(m),i[m]=p.value(),void 0!=u[m]&&(h[m].setValue(p.value()),t.schemas.addSchemasForProperty(m,u[m]))}else if("remove"==p.action()||"move"==p.action()){var v=o.indexOf(m);if(-1==v)throw new Error("Cannot delete missing key: "+m);p.setSubjectValue(r.propertyValue(m)),o.splice(v,1),void 0!=h[m]&&h[m].setValue(void 0),delete i[m]}else if("replace"!=p.action())throw new Error("Unrecognised patch operation: "+p.action())}else if("array"==a){if(!g(m))throw new Error("Cannot patch non-numeric index: "+m);var y=parseInt(m);if("add"==p.action()){if(y>s)throw new Error("Cannot add past the end of the list");for(var b=s-1;b>=y;b--)void 0!=c[b+1]&&(void 0==l[b]?c[b+1].setValue(i[b]):c[b+1].setValue(l[b].value()));i.splice(y,0,p.value()),s++,void 0!=l[i.length-1]&&t.schemas.addSchemasForIndex(i.length-1,l[i.length-1])}else if("remove"==p.action()||"move"==p.action()){if(y>=s)throw new Error("Cannot remove a non-existent index");p.setSubjectValue(r.itemValue(y));for(var b=y;s-1>b;b++)void 0!=c[b]&&(void 0==l[b+1]?c[b].setValue(i[b+1]):c[b].setValue(l[b+1].value()));void 0!=c[s-1]&&c[s-1].setValue(void 0),s--,i.splice(y,1)}else if("replace"!=p.action())throw new Error("Unrecognised patch operation: "+p.action())}var S=p.targetChild(d);if("string"==typeof S)if(f[S]=!0,"object"==a){if("move"==p.action()){var v=o.indexOf(S);if(-1!=v)throw new Error("Cannot move to existing key: "+S);o.push(S),i[S]=p.subjectValue(),void 0!=u[S]&&t.schemas.addSchemasForProperty(S,u[S])}}else if("array"==a){if(!g(S))throw new Error("Cannot patch non-numeric index: "+S);var y=parseInt(S);if("move"==p.action()){if(y>s)throw new Error("Cannot add past the end of the list");for(var b=s-1;b>=y;b--)void 0!=c[b+1]&&(void 0==l[b]?c[b+1].setValue(i[b]):c[b+1].setValue(l[b].value()));i.splice(y,0,p.subjectValue()),s++,void 0!=l[i.length-1]&&t.schemas.addSchemasForIndex(i.length-1,l[i.length-1])}}}}),"object"==a)for(var p=0;p<o.length;p++){var m=o[p],v=e.filter("/"+_.encodePointerComponent(m));v.isEmpty()||this.property(m).patch(v)}else if("array"==a)for(var p=0;s>p;p++){var v=e.filter("/"+_.encodePointerComponent(p));v.isEmpty()||this.index(p).patch(v)}for(var m in f)t.schemas.update(m)},t.setValue=function(e){var n=_.guessBasicType(e,a),r=i;if(i=e,n!=a){if("object"==a)for(var d in u)h[d].setValue(void 0);else if("array"==a)for(var f in l)c[f].setValue(void 0);a=n}if("object"==n){for(var d in u)e.hasOwnProperty(d)?(u[d].defined()||t.schemas.addSchemasForProperty(d,u[d]),h[d].setValue(e[d])):h[d].setValue(void 0);o=Object.keys(e),s=0}else if("array"==n){for(var f in l)f<e.length?(l[f].defined()||t.schemas.addSchemasForIndex(f,l[f]),c[f].setValue(e[f])):c[f].setValue(void 0);o=[],s=e.length}else o=[],s=0;void 0===e?void 0!==r&&t.schemas.clear():t.schemas.update(null)},t.schemas=new E(this),this.schemas=function(i){if(i&&void 0==a&&n){if("array"===n.basicType()&&g(r))return n.schemas(!0).indexSchemas(r);if("object"===n.basicType())return n.schemas(!0).propertySchemas(r)}return e.access(),t.schemas.getSchemas()},this.whenSchemasStable=function(n){return e.access(),t.schemas.whenSchemasStable(n),this},this.links=function(n){return e.access(),t.schemas.getLinks(n)},this.addLink=function(n){return e.access(),t.schemas.addLink(n),this},this.addSchema=function(n,r){e.access();var i=this;return n instanceof P?n.each(function(e,t){i.addSchema(t,r)}):t.schemas.addSchema(n,r),this},this.removeSchema=function(n){return e.access(),t.schemas.removeSchema(n),this},this.addSchemaMatchMonitor=function(n,r,i,a,s){return e.access(),t.schemas.addSchemaMatchMonitor(n,r,i,a,s)},this.validate=function(){return e.access(),t.schemas.validate()}}function b(t,n){return e.getData(t).getRawResponse(function(e){e.document.root||e.document.setRoot("")}).getData(function(e,t){var r=e.asSchema();void 0!=n&&n.call(r,r,t)})}function S(t){return void 0==tt[t]&&(tt[t]=e.createSchema({type:t})),tt[t]}function x(e){this.data=e,e.referenceUrl(),e.propertyValue("id");var t=[],n=e.property("links");void 0!==n&&n.indices(function(e,n){t[t.length]=new O(n)}),this.links=function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r];(void 0==e||i.rel==e)&&n.push(i)}return n},this.schemaTitle=this.title()}function w(e){if("{@}"==e)return"{+%73elf}";for(var t=[],n=!1,r=!1,i=0;i<e.length;i++){var a=e.charAt(i);if(n)if(r){if(")"==a){")"==e.charAt(i+1)?(t.push(nt[")"]),i++):r=!1;continue}void 0!=nt[a]?t.push(nt[a]):t.push(encodeURIComponent(a))}else{if("$"==a){t.push("%73elf");continue}if("("==a){")"==e.charAt(i+1)?(t.push("%65mpty"),i++):r=!0;continue}"}"==a&&(n=!1),t.push(a)}else"{"==a&&(n=!0),t.push(a)}return t.join("")}function O(e){this.data=e,this.uriTemplate=new K(w(e.propertyValue("href"))),this.dataParts=[];for(var t=0;t<this.uriTemplate.varNames.length;t++)this.dataParts.push(j(this.uriTemplate.varNames[t]));var n=e.property("schema");if(n.defined()){var r=n.asSchema();this.submissionSchemas=new P([r])}else this.submissionSchemas=new P;var i=e.property("targetSchema");i.defined()&&(this.targetSchema=i.asSchema()),this.handlers=[],this.preHandlers=[]}function j(e){return"%65mpty"==e?"":"%73elf"==e?null:decodeURIComponent(e)}function C(e,t,n){this.rawLink=e,this.definition=t,this.subjectData=n,this.href=e.href;var r=this.href.indexOf("#");r>=0?(this.hrefBase=this.href.substring(0,r),this.hrefFragment=this.href.substring(r+1)):(this.hrefBase=this.href,this.hrefFragment=""),this.rel=e.rel,this.title=e.title,this.method=void 0!=e.method?e.method:"edit"==e.rel?"PUT":"create"==e.rel?"POST":"delete"==e.rel?"DELETE":"GET",void 0!=e.enctype&&(e.encType=e.enctype,delete e.enctype),this.encType=void 0==e.encType?"GET"==this.method?"application/x-www-form-urlencoded":"POST"==this.method||"PUT"==this.method?"application/json":"application/x-www-form-urlencoded":e.encType,null!=this.definition&&(this.submissionSchemas=this.definition.submissionSchemas,this.targetSchema=this.definition.targetSchema)}function k(e,t,n,r){var i=this;this.monitorKey=e,this.match=!1,this.matchFailReason=new L("initial failure",null),this.monitors=new s(n),this.impatientCallbacks=r,this.propertyMatches={},this.indexMatches={},this.dependencies={},this.dependencyKeys={},this.schemaLoaded=!1,this.data=t,n.getFull(function(e){i.schemaLoaded=!0,i.schema=e,i.basicTypes=e.basicTypes(),i.setupXorSelectors(),i.setupOrSelectors(),i.setupAndMatches(),i.setupNotMatches(),i.dataUpdated()})}function L(e,t,n){this.message=e,this.schema=t,this.subMatchFailReason=n}function I(e,t,n){var r=this;this.options=t,this.matchCallback=null,this.selectedOption=null,this.data=n,this.subMatches=[],this.subSchemaKeys=[];for(var i=0;i<t.length;i++)this.subSchemaKeys[i]=_.getKeyVariant(e,"option"+i),this.subMatches[i]=n.addSchemaMatchMonitor(this.subSchemaKeys[i],t[i],function(){r.update()},!1,!0);this.update()}function T(e,t,n){var r=this;this.options=t,this.matchCallback=null,this.selectedOptions=[],this.data=n,this.subMatches=[],this.subSchemaKeys=[];for(var i=0;i<t.length;i++)this.subSchemaKeys[i]=_.getKeyVariant(e,"option"+i),this.subMatches[i]=n.addSchemaMatchMonitor(this.subSchemaKeys[i],t[i],function(){r.update()},!1,!0);this.update()}function R(){ot=!1;var e=[];for(var t in st){var n=st[t];e.push({data:n,pointerPath:n.pointerPath()})}st={},e.sort(function(e,t){return e.pointerPath.length-t.pointerPath.length});for(var r=[],i=0;i<e.length;i++)r[i]=e[i].data;for(var i=0;i<at.length;i++)at[i].call(null,r)}function V(e){st[e.uniqueId]=e,ot||(ot=!0,B.add(R))}function A(e){for(var t=0;t<e.length;t++)this[t]=e[t];this.length=e.length}function P(e,t){if(void 0==e)return this.length=0,void 0;void 0==t&&(t=e),this.fixed=function(){var n=t.length<e.length?new P(t):this;return this.fixed=function(){return n},n};var n;for(n=0;n<e.length;n++)this[n]=e[n];this.length=e.length}function E(e){this.dataObj=e,this.schemas={},this.schemasFixed={},this.links={},this.matches={},this.xorSelectors={},this.orSelectors={},this.dependencySelectors={},this.schemaFlux=0,this.schemasStable=!0,this.schemasStableListeners=new o(e),this.pendingNotify=!1,this.cachedSchemaList=null,this.cachedLinkList=null}function M(e,t){this.dataObj=e,this.potentialLink=t,this.active=!1,this.rawLink=null,this.updateMonitors=new s(e)}function D(e,t,n,r){var i=_.getKeyVariant(t,"$");this.xorSelector=new I(t,e,r.dataObj),this.xorSelector.onMatchChange(function(t){r.removeSchema(i),null!=t?r.addSchema(t,i,n,!1):e.length>0&&r.addSchema(e[0],i,n,!1)})}function F(e,t,n,r){for(var i=[],a=[],s=0;s<e.length;s++)i[s]=_.getKeyVariant(t,"$"+s),a[s]=!1;this.orSelector=new T(t,e,r.dataObj),this.orSelector.onMatchChange(function(t){for(var s=0;s<e.length;s++){for(var o=!1,u=0;u<t.length;u++)if(e[s]==t[u]){o=!0;break}o&&!a[s]?r.addSchema(e[s],i[s],n,!1):!o&&a[s]&&r.removeSchema(i[s]),a[s]=o}0==t.length&&e.length>0&&(a[0]=!0,r.addSchema(e[0],i[0],n,!1))})}function N(e,t,n,r){this.inferredSchemaKeys={},this.applied={},this.schema=e,this.schemaKeyHistory=n,this.schemaSet=r;for(var i=this.schema.data.property("dependencies").keys(),a=0;a<i.length;a++){var s=i[a];this.inferredSchemaKeys[s]=_.getKeyVariant(t,"$"+a),this.dataUpdated(s)}}function U(e,t){var n=this;this.errors=[],this.valid=!0;var r=new s(t);this.onChange=function(e,n){var i=_.getKeyVariant(ct);r.add(i,e),n!==!1&&e.call(t,this)},e.updateMonitors.add(ct,function(){n.errors=[];for(var t in e.matchErrors)n.errors=n.errors.concat(e.matchErrors[t]);n.valid=0===n.errors.length,r.notify(n)})}function H(e){this.schemaSet=e,this.matchErrors={},this.updateMonitors=new s(this),this.publicVersion=new U(this,e.dataObj)}var J=e;e.toString=function(){return"<Jsonary>"},e.plugins={},t.prototype={toString:function(){var e="";return null!=this.scheme&&(e+=this.scheme+":"),this.doubleSlash&&(e+="//"),null!=this.username&&(e+=this.username,null!=this.password&&(e+=":"+this.password),e+="@"),null!=this.domain&&(e+=this.domain),null!=this.port&&(e+=":"+this.port),null!=this.path&&(e+=this.path),null!=this.query&&(e+="?"+this.query),null!=this.fragment&&(e+="#"+this.fragment),e},queryObj:function(){var e={};if(this.query)for(var t=0;t<this.query.length;t++){var n=this.query[t];e[n.key]=n.value}return e},resolve:function(e){var n=new t(e+"");if(null==n.scheme&&(n.scheme=this.scheme,n.doubleSlash=this.doubleSlash,null==n.domain))if(n.domain=this.domain,n.port=this.port,n.username=this.username,n.password=this.password,null==n.path)n.path=this.path,null==n.query&&(n.query=this.query);else if("/"!=n.path.charAt(0)&&null!=this.path){var r,i="/"==this.path.charAt(0);r=i?this.path.substring(1).split("/"):this.path.split("/"),".."==r[r.length-1]&&r.push(""),r.pop();for(var a=r.length-1;a>=0;a--)"."==r[a]&&r.slice(a,1);for(var s=n.path.split("/"),a=0;a<s.length;a++){var o=s[a];if("."!=o)if(".."==o){if(r.length>0&&".."!=r[r.length-1])r.pop();else if(!i){r=r.concat(s.slice(a));break}}else r.push(o)}n.path=(i?"/":"")+r.join("/")}return n.toString()}},e.baseUri=null,t.resolve=function(n,r){if(void 0==r)if(r=n,e.baseUri)n=e.baseUri;else{if("undefined"==typeof window)return n;n=window.location.href}return void 0==n?r:(n instanceof t||(n=new t(n)),n.resolve(r))},t.parse=function(e){return new t(e)};var q={toString:function(){for(var e=[],t=0;t<this.length;t++)"undefined"==typeof this[t].value?e.push(this[t].key):e.push(this[t].key+"="+encodeURIComponent(this[t].value));return e.join("&")},get:function(e,t){for(var n=this.length-1;n>=0;n--)if(this[n].key==e)return this[n].value;return t},set:function(e,t){for(var n=this.length-1;n>=0;n--)if(this[n].key==e)return this[n].value=t,void 0;this.push({key:e,value:t})}};e.Uri=t;var K=function(){function e(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function t(t){var n="";r[t.charAt(0)]&&(n=t.charAt(0),t=t.substring(1));var a="",s="",o=!0,u=!1,h=!1;"+"==n?o=!1:"."==n?(s=".",a="."):"/"==n?(s="/",a="/"):"#"==n?(s="#",o=!1):";"==n?(s=";",a=";",u=!0,h=!0):"?"==n?(s="?",a="&",u=!0):"&"==n&&(s="&",a="&",u=!0);for(var l=[],c=t.split(","),d=[],f={},p=0;p<c.length;p++){var m=c[p],v=null;if(-1!=m.indexOf(":")){var g=m.split(":");m=g[0],v=parseInt(g[1])}for(var y={};i[m.charAt(m.length-1)];)y[m.charAt(m.length-1)]=!0,m=m.substring(0,m.length-1);var b={truncate:v,name:m,suffices:y};d.push(b),f[m]=b,l.push(m)}var S=function(t){for(var n="",r=0,i=0;i<d.length;i++){var l=d[i],c=t(l.name);if(null==c||Array.isArray(c)&&0==c.length||"object"==typeof c&&0==Object.keys(c).length)r++;else if(n+=i==r?s:a||",",Array.isArray(c)){u&&(n+=l.name+"=");for(var f=0;f<c.length;f++)f>0&&(n+=l.suffices["*"]?a||",":",",l.suffices["*"]&&u&&(n+=l.name+"=")),n+=o?encodeURIComponent(c[f]).replace(/!/g,"%21"):e(c[f])}else if("object"==typeof c){u&&!l.suffices["*"]&&(n+=l.name+"=");var p=!0;for(var m in c)p||(n+=l.suffices["*"]?a||",":","),p=!1,n+=o?encodeURIComponent(m).replace(/!/g,"%21"):e(m),n+=l.suffices["*"]?"=":",",n+=o?encodeURIComponent(c[m]).replace(/!/g,"%21"):e(c[m])}else u&&(n+=l.name,h&&""==c||(n+="=")),null!=l.truncate&&(c=c.substring(0,l.truncate)),n+=o?encodeURIComponent(c).replace(/!/g,"%21"):e(c)}return n},x=function(e,t){if(s){if(e.substring(0,s.length)!=s)return null;e=e.substring(s.length)}if(1==d.length&&d[0].suffices["*"]){for(var n=d[0],r=n.name,i=n.suffices["*"]?e.split(a||","):[e],h=o&&-1!=e.indexOf("="),l=1;l<i.length;l++){var e=i[l];h&&-1==e.indexOf("=")&&(i[l-1]+=(a||",")+e,i.splice(l,1),l--)}for(var l=0;l<i.length;l++){var e=i[l];o&&-1!=e.indexOf("=")&&(h=!0);for(var c=e.split(","),p=0;p<c.length;p++)o&&(c[p]=decodeURIComponent(c[p]));i[l]=1==c.length?c[0]:c}if(u||h){for(var m=t[r]||{},p=0;p<i.length;p++){var v=e;if("string"==typeof i[p]){var e=i[p],g=e.split("=",1)[0],e=e.substring(g.length+1);v=e}else{var e=i[p][0],g=e.split("=",1)[0],e=e.substring(g.length+1);i[p][0]=e,v=i[p]}void 0!==m[g]?Array.isArray(m[g])?m[g].push(v):m[g]=[m[g],v]:m[g]=v}t[r]=1==Object.keys(m).length&&void 0!==m[r]?m[r]:m}else t[r]=void 0!==t[r]?Array.isArray(t[r])?t[r].concat(i):[t[r]].concat(i):1!=i.length||n.suffices["*"]?i:i[0]}else{for(var i=1==d.length?[e]:e.split(a||","),y={},l=0;l<i.length;l++){for(var b=0;b<d.length-1&&l>b&&!d[b].suffices["*"];b++);if(p!=l){for(var S=d.length-1;S>0&&d.length-S<i.length-l&&!d[S].suffices["*"];S--);y[l]=d.length-S!=i.length-l?b:S}else y[l]=l}for(var l=0;l<i.length;l++){var e=i[l],c=e.split(",");if(u){var e=c[0],r=e.split("=",1)[0],e=e.substring(r.length+1);c[0]=e;var n=f[r]||d[0]}else var n=d[y[l]],r=n.name;for(var p=0;p<c.length;p++)o&&(c[p]=decodeURIComponent(c[p]));t[r]=(u||n.suffices["*"])&&void 0!==t[r]?Array.isArray(t[r])?t[r].concat(c):[t[r]].concat(c):1!=c.length||n.suffices["*"]?c:c[0]}}};return S.varNames=l,{prefix:s,substitution:S,unSubstitution:x}}function n(e){if(!(this instanceof n))return new n(e);for(var r=e.split("{"),i=[r.shift()],a=[],s=[],o=[],u=[];r.length>0;){var h=r.shift(),l=h.split("}")[0],c=h.substring(l.length+1),d=t(l);s.push(d.substitution),o.push(d.unSubstitution),a.push(d.prefix),i.push(c),u=u.concat(d.substitution.varNames)}this.fill=function(e){for(var t=i[0],n=0;n<s.length;n++){var r=s[n];t+=r(e),t+=i[n+1]}return t},this.fromUri=function(e){for(var t={},n=0;n<i.length;n++){var r=i[n];if(e.substring(0,r.length)!==r)return void 0;if(e=e.substring(r.length),n>=i.length-1){if(""==e)break;return void 0}for(var s=i[n+1],u=n;;){if(u==i.length-2){var h=e.substring(e.length-s.length);if(h!==s)return void 0;var l=e.substring(0,e.length-s.length);e=h}else if(s){var c=e.indexOf(s),l=e.substring(0,c);e=e.substring(c)}else if(a[u+1]){var c=e.indexOf(a[u+1]),l=e.substring(0,c);e=e.substring(c)}else{if(i.length>u+2){u++,s=i[u+1];continue}var l=e;e=""}break}o[n](l,t)}return t},this.varNames=u}var r={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},i={"*":!0};return n.prototype={fillFromObject:function(e){return this.fill(function(t){return e[t]})}},"undefined"!=typeof module&&(module.exports=n),this&&(this.UriTemplate=n),n}.call(this),_={guessBasicType:function(e){return null===e?"null":Array.isArray(e)?"array":"object"==typeof e?"object":"string"==typeof e?"string":"number"==typeof e?0==e%1?"integer":"number":"boolean"==typeof e?"boolean":void 0},resolveRelativeUri:function(e,n){return t.resolve(e,n)},urlsEqual:function(e,t){return"#"==e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),"#"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),e==t},linksEqual:function(e,t){if(void 0==e||void 0==t)return e==t;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(r.href!=i.href||r.rel!=i.rel)return!1;if(r.method!=i.method||r["enc-type"]!=i["enc-type"])return!1;if(r.schema!=i.schema)return!1}return!0},log:function(e,t){try{e>=_.logLevel.ERROR&&(window.alert("ERROR: "+t),console.log("ERROR: "+t),console.trace()),e>=_.logLevel.WARNING&&console.log("WARNING: "+t)}catch(n){}},logLevel:{DEBUG:-1,STANDARD:0,WARNING:1,ERROR:2},getKeyVariant:function(e,t){if(void 0==t&&(t=_.getUniqueKey()),t+="",t.indexOf(".")>=0)throw new Error("variant name cannot contain a dot: "+t);return e+"."+t},keyIsVariant:function(e,t){return e+="",t+="",e===t||e.substring(0,t.length+1)===t+"."},keyIsRoot:function(e){return-1==e.indexOf(".")},hcf:function(e,t){for(e=Math.abs(e),t=Math.abs(t);;){var n=e%t;if(0==n)return t;if(isNaN(n))return 0/0;e=t,t=n}},recursiveCompare:function(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!_.recursiveCompare(e[n],t[n]))return!1;return!0}if("object"==typeof e){for(var r in e)if(void 0===t[r]&&void 0!==e[r])return!1;for(var r in t)if(void 0===e[r]&&void 0!==e[r])return!1;for(var r in e)if(!_.recursiveCompare(e[r],t[r]))return!1;return!0}return e===t},lcm:function(e,t){return Math.abs(e*t/this.hcf(e,t))},encodeData:function(e,t,n){if(void 0==t&&(t="application/x-www-form-urlencoded"),"application/json"==t)return JSON.stringify(e);if("application/x-www-form-urlencoded"==t)return"dotted"==n?_.formEncode(e,"",".","","|").replace(/%20/g,"+").replace(/%2F/g,"/"):"pretty"==n?_.formEncode(e,"","[","]").replace(/%20/g,"+").replace(/%2F/g,"/").replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/%7C/g,"|"):_.formEncode(e,"","[","]").replace(/%20/g,"+");throw new Error("Unknown encoding type: "+this.encType)},decodeData:function(e,t,n){if(void 0==t&&(t="application/x-www-form-urlencoded"),"application/json"==t)return JSON.parse(e);if("application/x-www-form-urlencoded"==t)return e=e.replace(/\+/g,"%20"),"dotted"==n?_.formDecode(e.replace(/%7C/g,"|"),".","","|"):_.formDecode(e,"[","]");throw new Error("Unknown encoding type: "+this.encType)},formEncode:function(e,t,n,r,i){void 0==t&&(t="");var a=[];if(Array.isArray(e))for(var s=0;s<e.length;s++){var o=""==t?s:t+encodeURIComponent(n+r),u=""==t?s:t+encodeURIComponent(n+s+r),h=e[s];if(null==h)a.push(o+"=null");else if("object"==typeof h){var l=_.formEncode(h,u,n,r,i);l&&a.push(l)}else"boolean"==typeof h?h?a.push(o+"=true"):a.push(o+"=false"):""===h?a.push(o):a.push(o+"="+encodeURIComponent(h))
}else if("object"==typeof e){for(var o in e)if(e.hasOwnProperty(o)){var h=e[o];if(o=""!=t?t+encodeURIComponent(n+o+r):encodeURIComponent(o),void 0===h);else if(null===h)a.push(o+"=null");else if(i&&Array.isArray(h)){if(h.length>0){for(var c=[];c.length<h.length;)c[c.length]=encodeURIComponent(h[c.length]);var d=i+c.join(i);a.push(o+"="+d)}}else if("object"==typeof h){var l=_.formEncode(h,o,n,r,i);l&&a.push(l)}else"boolean"==typeof h?h?a.push(o+"=true"):a.push(o+"=false"):""===h?a.push(o):a.push(o+"="+encodeURIComponent(h))}}else a.push(encodeURIComponent(e));return a.join("&")},formDecodeString:function(e){return"true"==e?e=!0:"false"==e?e=!1:"null"==e?e=null:parseFloat(e)+""==e&&(e=parseFloat(e)),e},formDecode:function(e,t,n,r){var i={};if(""===e)return i;for(var a=e.split("&"),s=0;s<a.length;s++){var o=a[s],u=o,h="";if(o.indexOf("=")>=0)if(u=o.substring(0,o.indexOf("=")),h=decodeURIComponent(o.substring(o.indexOf("=")+1)),r&&h.charAt(0)==r){h=h.split(r),h.shift();for(var l=0;l<h.length;l++)h[l]=_.formDecodeString(h[l])}else h=_.formDecodeString(h);u=decodeURIComponent(u);for(var c=i,d=u.split(t),l=1;l<d.length;l++)d[l]=d[l].substring(0,d[l].length-n.length);for(var l=0;l<d.length;l++)Array.isArray(c)&&""==d[l]&&(d[l]=c.length),l==d.length-1?c[d[l]]=h:(void 0==c[d[l]]&&(c[d[l]]=""==d[l+1]?[]:{}),c=c[d[l]])}return i},escapeHtml:function(e,t){e+="";var n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;");return t?n:n.replace(/"/g,"&quot;")},encodePointerComponent:function(e){return e.toString().replace("~","~0").replace("/","~1")},decodePointerComponent:function(e){return e.toString().replace("~1","/").replace("~0","~")},splitPointer:function(e){var t=e.split("/");""==t[0]&&t.shift();for(var n=0;n<t.length;n++)t[n]=_.decodePointerComponent(t[n]);return t},joinPointer:function(e){for(var t="",n=0;n<e.length;n++)t+="/"+_.encodePointerComponent(e[n]);return t},prettyJson:function(e){function t(e){try{for(var t=JSON.stringify(JSON.parse(e)),n=t.split('"'),r=0;r<n.length;r++){var i=n[r];for(i=i.replace(/:/g,": "),i=i.replace(/,/g,", "),n[r]=i,r++;r<n.length&&"\\"==n[r].charAt(n[r].length-1);)r++}return n.join('"')}catch(a){return e}}var n=JSON.stringify(e,null,"	");return n=n.replace(/\{[^\{,}]*\}/g,t),n=n.replace(/\[[^\[,\]]*\]/g,t),n=n.replace(/\[[^\{\[\}\]]*\]/g,t)}};!function(){var e=0;_.getUniqueKey=function(){return e++}}();for(var $ in _.logLevel)_.logLevel[_.logLevel[$]]=_.logLevel[_.logLevel[$]]||$;e.getMonitorKey=_.getUniqueKey,e.getKeyVariant=function(e,t){return _.getKeyVariant(e,t?"~"+t:void 0)},e.keyIsVariant=_.keyIsVariant,e.log=function(e,t){if("number"!=typeof e)throw alert("First argument to log() must be a number (preferably enum value from .logLevel)"),new Error("First argument to log() must be a number (preferably enum value from .logLevel)");_.log(e,t)},e.setLogFunction=function(e){_.log=e},e.logLevel=_.logLevel,e.encodeData=_.encodeData,e.decodeData=_.decodeData,e.encodePointerComponent=_.encodePointerComponent,e.decodePointerComponent=_.decodePointerComponent,e.splitPointer=_.splitPointer,e.joinPointer=_.joinPointer,e.escapeHtml=_.escapeHtml,e.prettyJson=_.prettyJson,e.extend=function(t){for(var n in t)void 0==e[n]&&(e[n]=t[n])},a.prototype={resultForKey:function(e){for(var t=[];t.length<arguments.length-1;)t[t.length]=arguments[t.length+1];return this.forKey(e).apply(this,t)}},e.ResultCollector=a,s.prototype={add:function(e,t){if("string"!=typeof e&&"number"!=typeof e)throw new Error("First argument must be a monitorKey, obtained using getMonitorKey()");this.contents[e]=t,this.addKey(e)},addKey:function(e){var t;for(t=0;t<this.keyOrder.length;t++){var n=this.keyOrder[t];if(n==e)return;if(_.keyIsVariant(e,n))return this.keyOrder.splice(t,0,e),void 0}this.keyOrder.push(e)},remove:function(e){delete this.contents[e],this.removeKey(e);var t=e+".";for(var n in this.contents)n.substring(0,t.length)==t&&(this.removeKey(n),delete this.contents[n])},removeKey:function(e){var t=this.keyOrder.indexOf(e);t>=0&&this.keyOrder.splice(t,1)},notify:function(){for(var e=arguments,t=0;t<this.keyOrder.length;t++){var n=this.keyOrder[t],r=this.contents[n];r.apply(this.context,e)}},isEmpty:function(){var e;for(e in this.contents)if(0!==this.contents[e].length)return!1;return!0}},o.prototype={add:function(e){this.listeners[this.listeners.length]=e},notify:function(){for(var e=arguments;this.listeners.length>0;){var t=this.listeners.shift();t.apply(this.context,e)}},isEmpty:function(){return 0===this.listeners.length}};var B={depth:0,callbacks:[],increment:function(){this.depth++},decrement:function(){if(this.depth--,this.depth<0)throw new Error("DelayedCallbacks.depth cannot be < 0");for(;0==this.depth&&this.callbacks.length>0;){var e=this.callbacks.shift();this.depth++,e(),this.depth--}},add:function(e){this.depth++,this.callbacks.push(e),this.decrement()}};"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")});var G=new s(null);e.beforeAjax=function(e){G.add("monitor",e)},e.ajaxFunction=function(e,t){var n=e.url,r=e.data,i=e.encType,a=new XMLHttpRequest;if(a.onreadystatechange=function(){if(4==a.readyState)if(a.status>=200&&a.status<300){var e=a.responseText||null;try{e=JSON.parse(e)}catch(n){if(204!=a.status)return t(n,e),void 0;e=null}var r=a.getAllResponseHeaders();if(""==r){r=[];for(var i=["Cache-Control","Content-Language","Content-Type","Expires","Last-Modified","Pragma"],s=0;s<i.length;s++){var o=a.getResponseHeader(i[s]);""!=o&&null!=o&&r.push(i[s]+": "+o)}r=r.join("\n")}t(null,e,r)}else{var e=a.responseText||null;try{e=JSON.parse(e)}catch(n){}var r=a.getAllResponseHeaders();if(""==r){r=[];for(var i=["Cache-Control","Content-Language","Content-Type","Expires","Last-Modified","Pragma"],s=0;s<i.length;s++){var o=a.getResponseHeader(i[s]);""!=o&&null!=o&&r.push(i[s]+": "+o)}r=r.join("\n")}t(new c(a.status,a),e,r)}},a.open(e.method,n,!0),e.headers)for(var s in e.headers){var o=e.headers[s];Array.isArray(o)||(o=[o]);for(var u=s.split("-"),h=0;h<u.length;h++)u[h].length>0&&(u[h]=u[h].charAt(0).toUpperCase()+u[h].substring(1).toLowerCase());s=u.join("-"),a.setRequestHeader(s,o.join(", "))}a.setRequestHeader("Content-Type",i),a.setRequestHeader("If-Modified-Since","Thu, 01 Jan 1970 00:00:00 GMT"),a.send(r)},function(){var t={},n={},r=function(e,r){return void 0!==r?(t[e]=r,n[e]=(new Date).getTime(),void 0):t[e]};r.cacheSeconds=10,r.empty=function(e){return},r.invalidate=function(e){"string"==typeof e&&(e=_.resolveRelativeUri(e));for(var n in t){var r=t[n],i=r.url;"string"==typeof e?-1!=i.indexOf(e)&&r.invalidate():e.test(i)&&r.invalidate()}},e.defaultCache=r,e.invalidate=r.invalidate}(),u.prototype={toString:function(){return"[Jsonary Request]"}},e.addToCache=l,e.getData=function(e,t,n){"string"==typeof e&&(e={url:e});var r=h(e.url,e.method,e.data,e.encType,null,n,e.headers).fragmentRequest;return void 0!=t&&r.getData(t),r},e.isRequest=function(e){return e instanceof d||e instanceof u},c.prototype=new Error,e.HttpError=c,d.prototype={beingUsed:function(){return void 0==this.baseContext?(_.log(_.logLevel.DEBUG,"No base context: "+this.url),!0):this.baseContext.retainCount()>0},getResponse:function(e){this.responseListeners.add(e),this.checkForFullResponse()},checkForFullResponse:function(){this.document.raw.defined()&&this.responseListeners.notify(this.document.raw,this)},ajaxSuccess:function(e,t,n){this.fetched=!0;var r=this;r.successful=!0,_.log(_.logLevel.STANDARD,"Request success: "+this.url);for(var i=t.replace(/\r\n/g,"\n").split("\n"),a={},s=null,o={},u=0;u<i.length;u++){var h=i[u].split(": ")[0];if(""!=h){var l=i[u].substring(h.length+2);"\r"==l[l.length-1]&&(l=l.substring(0,l.length-1)),h=h.toLowerCase();for(var c=l.split(", "),d=0;d<c.length;d++){var l=c[d];void 0==a[h]?a[h]=l:"object"==typeof a[h]?a[h].push(l):a[h]=[a[h],l]}}}_.log(_.logLevel.DEBUG,"headers: "+JSON.stringify(a,null,4));for(var s=a["content-type"].split(";")[0],f=a["content-type"].substring(s.length+1);f.length>0;){f=f.replace(/^,\s*/,"");var p=f.split("=",1)[0];if(f=f.substring(p.length+1).trim(),p=p.trim(),""!=p)if('"'===f.charAt(0)){partValue=/^"([^\\"]|\\.)*("|$)/.exec(f)[0],f=f.substring(partValue.length).trim();try{o[p]=JSON.parse(partValue)}catch(m){o[p]=partValue}}else partValue=/^[^,]*/.exec(f)[0],f=f.substring(partValue.length).trim(),o[p]=partValue}if(r.headers=a,r.contentType=s,r.contentTypeParameters=o,r.document.http.error=null,r.document.http.headers=a,r.document.setRaw(e),r.profileUrl=null,r.document.raw.removeSchema(lt),void 0!=o.profile){var v=o.profile;v=_.resolveRelativeUri(r.url,v),r.profileUrl=v,r.document.raw.addSchema(v,lt)}else void 0!=n&&r.document.raw.addSchema(n,lt);if(void 0!=o.root){var g={href:o.root,rel:"root"};r.document.raw.addLink(g)}if(a.link)for(var y="object"==typeof a.link?a.link:[a.link],u=0;u<y.length;u++){var g=y[u],b=g.trim().split(";"),S=b.shift().trim();S=S.substring(1,S.length-1);for(var x={href:S},d=0;d<b.length;d++){var w=b[d],O=w.substring(0,w.indexOf("=")),l=w.substring(O.length+1);O=O.trim(),'"'==l.charAt(0)&&(l=JSON.parse(l)),"type"==O&&(O="mediaType"),x[O]=l}r.document.raw.addLink(x)}r.checkForFullResponse(),r.waitingForRoot=!0,r.document.raw.whenSchemasStable(function(){delete r.waitingForRoot;var e=r.document.raw.getLink("root");if(void 0!=e){var t=decodeURI(e.href.substring(e.href.indexOf("#")+1));r.document.setRoot(t)}else r.document.setRoot("")})},ajaxError:function(e,t,n){this.fetched=!0;var r=this;r.successful=!1,r.error=e,_.log(_.logLevel.WARNING,"Error fetching: "+this.url+" ("+e.message+")"),r.document.http.error=e,r.document.http.headers=n,r.document.setRaw(t),r.document.raw.whenSchemasStable(function(){r.document.setRoot(""),r.checkForFullResponse()})},fetchData:function(t,n,r,i,a,s){J.log(J.logLevel.DEBUG,"Document "+this.document.uniqueId+" is unstable");var u=new o(this);this.document.whenStable=function(e){return u.add(e),this};var h=this;this.successful=null;var l=t,c=r;if("GET"!=n&&"DELETE"!=n||void 0==c||""==c||(l+=-1==l.indexOf("?")?"?":"&",l+=c,c=void 0),e.config.antiCacheUrls){var d="_="+Math.random();l+=-1==l.indexOf("?")?"?"+d:"&"+d}var f={url:l,data:c,encType:i,method:n,headers:s||{}};G.notify(f);var p=function(t,n,r){t?h.ajaxError(t,n,r):("PUT"==f.method&&e.invalidate(f.url),h.ajaxSuccess(n,r,a)),J.log(J.logLevel.DEBUG,"Document "+h.document.uniqueId+" is stable"),delete h.document.whenStable,u.notify(h.document)};if(/^data:/.test(l)){var m=l.split(",",1)[0],v=l.substring(m.length+1);m=m.substring(5);var g,y=m.split(";"),b=y[0],S=-1!==y.indexOf("base64"),x="Content-Type: "+b.replace(/\s/g,""),w=null;S?(w=new Error("base64 data URLs not supported yet"),g=v):g=decodeURIComponent(v.replace(/\+/g,"%20"));try{g=JSON.parse(g)}catch(O){}return p(w,g,x)}e.ajaxFunction(f,p)}},f.prototype=d.prototype,p.prototype={isEmpty:function(){return 0==this.operations.length},each:function(e){for(var t=0;t<this.operations.length;t++)e.call(this,t,this.operations[t]);return this},plain:function(){for(var e=[],t=0;t<this.operations.length;t++)e[t]=this.operations[t].plain();return e},condense:function(){},filterImmediate:function(){for(var e=new p(this.prefix),t=0;t<this.operations.length;t++){var n=this.operations[t];n.immediateChild(this.prefix)&&e.operations.push(n)}return e},filter:function(e){e=this.prefix+e;for(var t=new p(e),n=0;n<this.operations.length;n++){var r=this.operations[n];r.hasPrefix(e)&&t.operations.push(r)}return t},filterRemainder:function(e){e=this.prefix+e;for(var t=new p(this.prefix),n=0;n<this.operations.length;n++){var r=this.operations[n];r.hasPrefix(e)||t.operations.push(r)}return t},replace:function(e,t){var n=new m("replace",e,t);return this.operations.push(n),this},add:function(e,t){var n=new m("add",e,t);return this.operations.push(n),this},remove:function(e){var t=new m("remove",e);return this.operations.push(t),this},move:function(e,t){var n=new m("move",e,t);return this.operations.push(n),this},inverse:function(){for(var e=new p(this.prefix),t=0;t<this.operations.length;t++)e.operations[t]=this.operations[t].inverse();return e.operations.reverse(),e}},m.prototype={action:function(){return this._patchType},value:function(){return this._value},subject:function(){return this._subject},setSubjectValue:function(e){return this._subjectValue=e,this},subjectValue:function(){return this._subjectValue},inverse:function(){switch(this._patchType){case"replace":return new m("replace",this._subject,this._subjectValue);case"add":return new m("remove",this._subject).setSubjectValue(this._value);case"remove":return new m("add",this._subject,this._subjectValue);case"move":return new m("move",this._target,this._subject);default:throw new Error("Unrecognised patch type for inverse: "+this._patchType)}},depthFrom:function(e){"object"==typeof e&&(e=e.pointerPath());var t=0/0;if(this._subject.substring(0,e.length)==e){var n=this._subject.substring(e.length);0==n.length?t=0:"/"==n.charAt(0)&&(t=n.split("/").length)}if(void 0!=this._target&&this._target.substring(0,e.length)==e){var r,n=this._target.substring(e.length);0==n.length?r=0:"/"==n.charAt(0)&&(r=n.split("/").length),!isNaN(r)&&t>r&&(t=r)}return t},subjectEquals:function(e){return this._subject==e},subjectChild:function(e){if(e+="/",this._subject.substring(0,e.length)==e){var t=this._subject.substring(e.length);if(-1==t.indexOf("/"))return _.decodePointerComponent(t)}return!1},subjectRelative:function(e){return e+="/",this._subject.substring(0,e.length)==e?this._subject.substring(e.length-1):!1},target:function(){return this._target},targetEquals:function(e){return this._target==e},targetChild:function(e){if(void 0!=this._target){if(e+="/",this._target.substring(0,e.length)==e){var t=this._target.substring(e.length);if(-1==t.indexOf("/"))return _.decodePointerComponent(t)}return!1}},targetRelative:function(e){return e+="/",this._target.substring(0,e.length)==e?this._target.substring(e.length-1):!1},plain:function(){var e={};return e[this._patchType]=this._subject,"remove"==this._patchType||("move"==this._patchType?e.to=this._target:e.value=this._value),e},matches:function(e){return this._subject==e?!0:"move"==this._patchType&&this._target==e?!0:!1},hasPrefix:function(e){return"object"==typeof e&&(e=e.pointerPath()),this.matches(e)?!0:(e+="/",this._subject.substring(0,e.length)==e?!0:"move"==this._patchType&&this._target.substring(0,e.length)==e?!0:!1)}};var W=[];e.registerChangeListener=function(e){W.push(e)};var X=!1,Q=[];e.batch=function(t){return void 0!=t?(e.batch(),t(),e.batchDone(),this):(X=!0,this)},e.batchDone=function(){for(X=!1;Q.length>0;){var e=Q.shift(),t=e.batchPatch;delete e.batchPatch,e.patch(t)}return this},v.prototype={toString:function(){return"[Jsonary Document]"},resolveUrl:function(e){return t.resolve(this.url,e)},get:function(e){return this.root.get(e)},set:function(e,t){return this.root.set(e,t),this},move:function(e,t){var n=new p;return n.move(e,t),this.patch(n),this},whenStable:function(e){return e.call(this,this),this}};var Y=/^(0|[1-9]\d*)$/,Z="meta-schema-key",z=0;y.prototype={toString:function(){return"[Jsonary Data]"},referenceUrl:function(){if(this.document.isDefinitive){var e=this.pointerPath();if(""==e||"/"==e.charAt(0))return this.document.url+"#"+encodeURI(this.pointerPath())}},subPath:function(e){var t=e.split("/");if(""!=t[0])throw new Error("Path must begin with / (or be empty): "+e);for(var n=this,r=1;r<t.length;r++)t[r]=_.decodePointerComponent(t[r]),n="array"==n.basicType()?n.index(t[r]):n.property(t[r]);return n},defined:function(){return void 0!=this.basicType()},setValue:function(e){if("undefined"==typeof e)return this.remove();if("object"!=this.basicType()&&"array"!=this.basicType()&&this.value()===e)return this;var t=new p;return this.defined()?t.replace(this.pointerPath(),e):t.add(this.pointerPath(),e),this.document.patch(t,this),this},remove:function(){var e=new p;return e.remove(this.pointerPath()),this.document.patch(e,this),this},itemValue:function(e){return this.index(e).value()},removeItem:function(e){return this.index(e).remove(),this},insertItem:function(e,t){if("array"!=this.basicType())throw Error("cannot insert into a non-array");var n=new p;return n.add(this.item(e).pointerPath(),t),this.document.patch(n,this),this},push:function(e){if("array"!=this.basicType())throw new Error("Can only push() on an array");return this.index(this.length()).setValue(e),this},propertyValue:function(e){return this.property(e).value()},removeProperty:function(e){return this.property(e).remove(),this},moveTo:function(e){if("object"==typeof e){if(e.document!=this.document){var t=this.value();return this.remove(),e.setValue(t),e}e=e.pointerPath()}var n=new p,r=this.pointerPath();return e!=r?(n.move(r,e),this.document.patch(n,this),this.document.root.subPath(e)):void 0},getLink:function(e){var t=this.links(e);return t[0]},equals:function(e){var t,n=this.basicType();if(n!=e.basicType())return!1;if("array"==n){if(this.length()!==e.length())return!1;for(t=0;t<this.length();t++)if(!this.index(t).equals(e.index(t)))return!1;return!0}if("object"==n){var t,r=this.keys(),i=e.keys();if(r.length!=i.length)return!1;for(r.sort(),i.sort(),t=0;t<r.length;t++)if(r[t]!==i[t])return!1;for(t=0;t<r.length;t++){var a=r[t];if(!this.property(a).equals(e.property(a)))return!1}return!0}return this.value()===e.value()},readOnlyCopy:function(){if(this.readOnly(!1))return this;var t=this.resolveUrl("#:copy"),n=e.create(this.value(),t,!0);return n.addSchema(this.schemas().fixed()),n},editableCopy:function(){var t=this.resolveUrl("#:copy"),n=e.create(this.value(),t,!1);return n.addSchema(this.schemas().fixed()),n},asSchema:function(){var e=this.readOnlyCopy(),t=new x(e);return this.readOnly(!1)&&i(this,{asSchema:t}),e.property("$ref").defined()||e.addSchema("http://json-schema.org/hyper-schema",Z),t},asLink:function(e){var t,n=this.readOnlyCopy(),r=new O(n);return t=void 0==e?r.linkForData(this):r.linkForData(e),this.readOnly(!1)&&i(this,{asLink:t}),t},items:function(e){for(var t=0;t<this.length();t++){var n=this.index(t);e.call(n,t,n)}return this},properties:function(e,t,n){var r;if("function"==typeof e&&(t=e,e=this.keys()),t)for(var i=0;i<e.length;i++){var a=this.property(e[i]);t.call(a,e[i],a)}if(n){"function"!=typeof n&&(n=t);for(var r=this.keys(),i=0;i<r.length;i++)if(-1==e.indexOf(r[i])){var a=this.property(r[i]);n.call(a,r[i],a)}}return this},resolveUrl:function(e){for(var n=this;n;){var r=n.getLink("self");if(r)return t.resolve(r.href,e);n=n.parent()}return this.document.resolveUrl(e)},get:function(e){return e?this.subPath(e).value():this.value()},set:function(e,t){return 1==arguments.length?this.setValue(e):(this.subPath(e).setValue(t),this)},json:function(e){return JSON.stringify(this.value(),null,e)},whenStable:function(e){var t=this;return this.document.whenStable(function(){t.whenSchemasStable(e.bind(t,t))}),this},valid:function(){return this.validate().valid}},y.prototype.indices=y.prototype.items,y.prototype.indexValue=y.prototype.itemValue,y.prototype.removeIndex=y.prototype.removeItem,y.prototype.index=function(e){return this.item(e)},e.extendData=function(e){for(var t in e)void 0==y.prototype[t]&&(y.prototype[t]=e[t])},e.create=function(e,t,n){var e="object"==typeof e?JSON.parse(JSON.stringify(e)):e,r=void 0!=t&&n;if(void 0!=t&&-1!=t.indexOf("#")){var i=t.substring(t.indexOf("#")+1);""!=i&&(r=!1),t=t.substring(0,t.indexOf("#"))}var a=new v(t,r,n);return a.setRaw(e),a.setRoot(""),a.root},e.isData=function(e){return e instanceof y},y.prototype.deflate=function(){return this.document.deflate(),{document:this.document.deflate(),path:this.pointerPath()}},v.prototype.deflate=function(){if(this.isDefinitive)return this.url;var e=this.raw,t=[];e.schemas().fixed().each(function(e,n){void 0!=n.referenceUrl()?t.push(n.referenceUrl()):t.push(n.data.deflate())});var n={baseUrl:this.url,readOnly:this.readOnly,value:e.value(),schemas:t,root:this.rootPath()};return n},e.inflate=function(t,n){if(void 0!==t.path&&void 0!==t.document)return e.inflate(t.document).root.subPath(t.path);if("string"==typeof t){var r=h(t).request;return n&&r.document.getRoot(function(e){e.whenSchemasStable(function(){n(null,r.document)})}),r.document}for(var i=e.create(t.value,t.baseUrl,t.readOnly),a=0;a<t.schemas.length;a++){var s=t.schemas[a];if("object"==typeof s)var s=e.inflate(s).asSchema();i.addSchema(s)}i.document.setRoot(t.root);var o=i.document;return n&&n(null,o),o},e.createSchema=function(t,n){var r=e.create(t,n,!0);return r.asSchema()},e.isSchema=function(e){return e instanceof x},e.getSchema=b;var et=["null","boolean","integer","number","string","array","object"],tt={};x.prototype={toString:function(){return"[Jsonary Schema]"},referenceUrl:function(e){return e&&this.data.property("$ref").defined()?this.data.resolveUrl(this.data.propertyValue("$ref")):this.data.referenceUrl()},isFull:function(){var e=this.data.propertyValue("$ref");return void 0===e},getFull:function(e,t){var n=this.data.propertyValue("$ref");if(void 0===n)return e&&e.call(this,this,void 0),this;if(t=t||[],n=this.data.resolveUrl(n),-1!==t.indexOf(n)){J.log(J.logLevel.ERROR,"Circular $ref cycle: "+JSON.stringify(t));var r=J.createSchema({title:"Circular $ref cycle",description:JSON.stringify(t)});return e&&e.call(r,r,void 0),r}if(t.push(n),"#"!=n.charAt(0)||1!=n.length&&"/"!=n.charAt(1)){if(!e){var i=this;return this.getFull(function(e){i=e}),i}if("#"==n.charAt(0)){var a=decodeURIComponent(n.substring(1)),s=this.data.document;s.getFragment(a,function(t){var n=t.asSchema();e.call(n,n,null)})}else b(n,e)}else{var o=this.data.document.root,u=decodeURIComponent(n.substring(1)),r=o.subPath(u).asSchema();if(!e)return r.getFull(null,t);r.getFull(e,t),e.call(r,r,null)}},title:function(){return this.data.propertyValue("title")||null},forceTitle:function(){var e=this.data.propertyValue("title")||null;if(null===e){if(this.enumData().defined())return"enum";var t=this.basicTypes();if(1==t.length){if("array"!=t[0]||this.tupleTyping())return t[0];var n=this.indexSchemas(0),r=n.forceTitle();if(r)return"array of "+r+" items"}}return e},hasDefault:function(){return this.data.property("default").defined()},defaultValue:function(){return this.data.propertyValue("default")},additionalPropertySchemas:function(){var e=[];return"object"==this.data.property("additionalProperties").basicType()&&e.push(this.data.property("additionalProperties").asSchema().getFull()),new P(e)},propertySchemas:function(e){var t=[],n=this.data.property("properties").property(e);return n.defined()&&t.push(n.asSchema().getFull()),this.data.property("patternProperties").properties(function(n,r){var i=new RegExp(n);i.test(e)&&t.push(r.asSchema().getFull())}),0==t.length&&(n=this.data.property("additionalProperties"),n.defined()&&t.push(n.asSchema().getFull())),new P(t)},propertyDependencies:function(e){var t=this.data.property("dependencies");if(t.defined()){var n=t.property(e);if(n.defined())return"string"==n.basicType()?[n.value()]:"array"==n.basicType()?n.value():[n.asSchema()]}return[]},itemSchemas:function(e){var t,n=this.data.property("items");if(!n.defined())return new P;if("array"==n.basicType()?(t=n.index(e),t.defined()||(t=this.data.property("additionalItems"))):t=n,t.defined()){var r=t.asSchema().getFull();return new P([r])}return new P},tupleTyping:function(){var e=this.data.property("items");return"array"==e.basicType()?e.length():0},uniqueItems:function(){return!!this.data.propertyValue("uniqueItems")},andSchemas:function(){var e=[],t=this.data.property("extends");return t.defined()&&("array"==t.basicType()?t.indices(function(t,n){e.push(n.asSchema())}):e.push(t.asSchema())),this.data.property("allOf").items(function(t,n){e.push(n.asSchema())}),new P(e).getFull()},notSchemas:function(){var t=[],n=this.data.property("disallow");return n.defined()&&("array"==n.basicType()?n.indices(function(n,r){"string"==r.basicType()?t.push(e.createSchema({type:r.value()})):t.push(r.asSchema())}):"string"==n.basicType()?t.push(e.createSchema({type:n.value()})):t.push(n.asSchema())),this.data.property("not").defined()&&t.push(this.data.property("not").asSchema()),new P(t).getFull()},types:function(){var e=this.data.property("type");if(e.defined()){if("string"===e.basicType())return"all"==e.value()||"any"==e.value()?et.slice(0):[e.value()];for(var t=[],n=0;n<e.length();n++){if("string"!=e.item(n).basicType())return et.slice(0);if("all"==e.item(n).value())return et.slice(0);t.push(e.item(n).value())}return-1!=t.indexOf("number")&&-1==t.indexOf("integer")&&t.push("integer"),t}return et.slice(0)},xorSchemas:function(){var e=[];if(this.data.property("oneOf").defined()){var t=[];this.data.property("oneOf").items(function(e,n){t.push(n.asSchema())}),e.push(t)}return e},orSchemas:function(){var e=[],t=this.data.property("type");if(t.defined())for(var n=0;n<t.length();n++)if("string"!=t.item(n).basicType()){var r=[];t.items(function(e,t){"string"==t.basicType()?r.push(S(t.value())):r.push(t.asSchema())}),e.push(r);break}if(this.data.property("anyOf").defined()){var r=[];this.data.property("anyOf").items(function(e,t){r.push(t.asSchema())}),e.push(r)}return e},equals:function(e,t){var n=this;if(t&&(e=e.getFull(),n=this.getFull()),n===e)return!0;var r=n.referenceUrl(),i=e.referenceUrl();return t&&!n.isFull()&&(r=n.data.resolveUrl(this.data.propertyValue("$ref"))),t&&!e.isFull()&&(i=e.data.resolveUrl(e.data.propertyValue("$ref"))),void 0!==r&&void 0!==i?_.urlsEqual(r,i):this.data.equals(e.data)},readOnly:function(){return!(!this.data.propertyValue("readOnly")&&!this.data.propertyValue("readonly"))},enumValues:function(){return this.data.propertyValue("enum")},enumData:function(){return this.data.property("enum")},minItems:function(){var e=this.data.propertyValue("minItems");return void 0==e?0:e},maxItems:function(){var e=this.data.propertyValue("maxItems");return this.tupleTyping()&&this.data.propertyValue("additionalItems")===!1&&(this.tupleTypingLength()>=e||(e=this.tupleTypingLength())),e},tupleTypingLength:function(){return"array"!=this.data.property("items").basicType()?0:this.data.property("items").length()},minLength:function(){var e=this.data.propertyValue("minLength");return void 0==e?0:e},maxLength:function(){return this.data.propertyValue("maxLength")},pattern:function(){var e=this.data.propertyValue("pattern");return void 0!==e?new RegExp(e):null},patternString:function(){return this.data.propertyValue("pattern")},numberInterval:function(){var e=this.data.propertyValue("multipleOf");return void 0==e&&(e=this.data.propertyValue("divisibleBy")),e},minimum:function(){return this.data.propertyValue("minimum")},exclusiveMinimum:function(){return!!this.data.propertyValue("exclusiveMinimum")},maximum:function(){return this.data.propertyValue("maximum")},exclusiveMaximum:function(){return!!this.data.propertyValue("exclusiveMaximum")},minProperties:function(){var e=this.data.propertyValue("minProperties");return void 0==e?0:e},maxProperties:function(){return this.data.propertyValue("maxProperties")},definedProperties:function(e){if(e)return this.definedProperties(),this.definedProperties(e);var t=this.data.property("properties").keys();return this.definedProperties=function(e){e=e||[];for(var n=[],r=0;r<t.length;r++)-1==e.indexOf(t[r])&&n.push(t[r]);return n},t.slice(0)},knownProperties:function(e){if(e)return this.knownProperties(),this.knownProperties(e);var t={};this.data.property("properties").properties(function(e){t[e]=!0});for(var n=this.requiredProperties(),r=0;r<n.length;r++)t[n[r]]=!0;var i=Object.keys(t);return this.knownProperties=function(e){e=e||[];for(var t=[],n=0;n<i.length;n++)-1==e.indexOf(i[n])&&t.push(i[n]);return t},i.slice(0)},requiredProperties:function(){var e=this.data.propertyValue("required");"object"!=typeof e&&(e=[]);var t=this.data.property("properties");return void 0!=t&&t.properties(function(t,n){var r=n.property("required");void 0!=r&&"boolean"==r.basicType()&&r.value()&&e.push(t)}),e},isAdditionalProperty:function(e){if(this.data.property("properties").property(e).defined())return!1;for(var t=this.data.property("patternProperties").keys(),n=0;n<t.length;n++){var r=new RegExp(t[n]);if(r.test(e))return!1}return!0},allowedAdditionalProperties:function(){return!(this.data.propertyValue("additionalProperties")===!1)},getLink:function(e){for(var t=this.links(),n=0;n<t.length;n++)if(t[n].rel()==e)return t[n]},asList:function(){return new P([this])},format:function(){return this.data.propertyValue("format")},unordered:function(){return!this.tupleTyping()&&this.data.propertyValue("unordered")},createValue:function(){var e=this.asList();return e.createValue.apply(e,arguments)},createData:function(){var e=this.asList();return e.createData.apply(e,arguments)}},x.prototype.basicTypes=x.prototype.types,x.prototype.extendSchemas=x.prototype.andSchemas,x.prototype.indexSchemas=x.prototype.itemSchemas,x.prototype.isComplete=x.prototype.isFull,e.extendSchema=function(e){for(var t in e)void 0==x.prototype[t]&&(x.prototype[t]=e[t])};var nt={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};O.prototype={addHandler:function(e){return this.handlers.unshift(e),this},addPreHandler:function(e){return this.preHandlers.push(e),this},canApplyTo:function(e){var t,n,r=null;for(t=0;t<this.dataParts.length;t++){if(n=this.dataParts[t],null===n?r=e:"object"==e.basicType()?r=e.property(n):"array"==e.basicType()&&g(n)&&(r=e.index(n)),void 0==r||!r.defined())return!1;if("null"==r.basicType())return!1}return!0},linkForData:function(e){var t=this.data.value(),n=this.uriTemplate.fill(function(t){return t=j(t),null==t?e.value():"array"==e.basicType()?e.itemValue(t):e.propertyValue(t)});return t.href=e.resolveUrl(n),t.rel=t.rel.toLowerCase(),t.title=t.title,new C(t,this,e)},usesKey:function(e){var t;for(t=0;t<this.dataParts.length;t++)if(this.dataParts[t]===e||null===this.dataParts[t])return!0;return!1},rel:function(){return this.data.propertyValue("rel").toLowerCase()}};var rt=[],it=[];e.addLinkHandler=function(e){rt.unshift(e)},e.removeLinkHandler=function(e){var t=rt.indexOf(e);-1!==t?rt.splice(t,1):_.log(_.logLevel.WARNING,"Attempted to remove link handler that wasn't registered")},e.addLinkPreHandler=function(e){it.push(e)},C.prototype={toString:function(){return this.href},createSubmissionData:function(t,n){"function"==typeof t&&(n=t,t=void 0);var r=this.hrefBase,i=this.submissionSchemas.getFull();if(n&&!t&&0==i.length&&"PUT"==this.method){var a=J.createSchema({readOnly:!0}),s=J.create("...").addSchema(a,"tmp");return J.getData(this.href,function(e){s.removeSchema("tmp"),s.set(e.get()),s.addSchema(e.schemas().fixed()),"function"==typeof n&&n(s)}),s}var o=e.isData(t)&&t.resolveUrl("")||r;return i.createData(t,o,n)},follow:function(t,n){"function"==typeof t&&(n=t,t=void 0),void 0!==t?t instanceof y||(t=e.create(t)):t=e.create(void 0);for(var r=it.concat(this.definition.preHandlers),i=0;i<r.length;i++){var a=r[i];if(a.call(this,this,t)===!1)return _.log(_.logLevel.DEBUG,"Link cancelled: "+this.href),null}var s=t.value(),o=e.getData({url:this.href,method:this.method,data:s,encType:this.encType},null,this.targetSchema);t=t.readOnlyCopy();var u=this.definition.handlers.concat(rt);void 0!==n&&u.unshift(n);for(var i=0;i<u.length;i++){var a=u[i];if("function"!=typeof a){if(a)continue;break}if(a.call(this,this,t,o)===!1)break}return o},valueForUrl:function(e){function t(e,t){t=t.getFull();var n=t.types();return-1!=n.indexOf("null")&&"null"==e?null:-1==n.indexOf("boolean")||"true"!=e&&"false"!=e?-1!=n.indexOf("string")?e:-1==n.indexOf("number")||isNaN(parseFloat(e))?-1!=n.indexOf("integer")&&0==parseFloat(e)%1?parseFloat(e):n.indexOf("object")?J.decodeData(e):void 0:parseFloat(e):"true"==e}var n=this.definition.uriTemplate,r=n.fromUri(e),i={},a=this.subjectData.schemas();for(var s in r){var o=r[s],u=j(s);if(null==u){if("string"==typeof o&&(o=t(o,a)),void 0===o)return void 0;
i=o}else{if("string"==typeof o&&(o=t(o,a.propertySchemas(u))),void 0===o)return void 0;i[u]=o}}return i}},k.prototype={setupXorSelectors:function(){var e=this;this.xorSelectors={};for(var t=this.schema.xorSchemas(),n=0;n<t.length;n++){var r=new I(_.getKeyVariant(this.monitorKey,"xor"+n),t[n],this.data);this.xorSelectors[n]=r,r.onMatchChange(function(){e.update()},!1)}},setupOrSelectors:function(){var e=this;this.orSelectors={};for(var t=this.schema.orSchemas(),n=0;n<t.length;n++){var r=new T(_.getKeyVariant(this.monitorKey,"or"+n),t[n],this.data);this.orSelectors[n]=r,r.onMatchChange(function(){e.update()},!1)}},setupAndMatches:function(){var e=this;this.andMatches=[];var t=this.schema.andSchemas();t.each(function(t,n){var r=_.getKeyVariant(e.monitorKey,"and"+t),i=e.data.addSchemaMatchMonitor(r,n,function(){e.update()},!1,!0);e.andMatches.push(i)})},setupNotMatches:function(){var e=this;this.notMatches=[];for(var t=this.schema.notSchemas(),n=0;n<t.length;n++)!function(t,n){var r=_.getKeyVariant(e.monitorKey,"not"+t),i=e.data.addSchemaMatchMonitor(r,n,function(){e.update()},!1,!0);e.notMatches.push(i)}(n,t[n])},addMonitor:function(e,t){return this.monitors.add(this.monitorKey,e),t!==!1&&e.call(this.schema,this.match,this.matchFailReason),this},dataUpdated:function(e){if(this.schemaLoaded){var t=this;if("object"==this.data.basicType()){this.indexMatches={},this.data.properties(function(e,n){if(void 0==t.propertyMatches[e]){var r=[],i=t.schema.propertySchemas(e);i.each(function(a){var s=n.addSchemaMatchMonitor(t.monitorKey,i[a],function(){t.subMatchUpdated(e,s)},!1,!0);r.push(s)}),t.propertyMatches[e]=r,t.addDependencies(e)}});var n=[];for(var e in this.propertyMatches)this.data.property(e).defined()||n.push(e);for(var r=0;r<n.length;r++){var e=n[r];delete this.propertyMatches[e],void 0!=this.dependencyKeys[e]&&(this.data.removeSchema(this.dependencyKeys[e]),delete this.dependencies[e],delete this.dependencyKeys[e])}}else if("array"==this.data.basicType()){this.propertyMatches={},this.data.indices(function(n,r){if(void 0==t.indexMatches[n]){var i=[],a=t.schema.indexSchemas(n);a.each(function(n){var s=r.addSchemaMatchMonitor(t.monitorKey,a[n],function(){t.subMatchUpdated(e,s)},!1,!0);i.push(s)}),t.indexMatches[n]=i}});var n=[];for(var e in this.indexMatches)this.data.length()<=e&&n.push(e);for(var r=0;r<n.length;r++)delete this.indexMatches[n[r]]}else this.propertyMatches={},this.indexMatches={};this.update()}},addDependencies:function(e){var t=this,n=this.schema.propertyDependencies(e);this.dependencies[e]=[],this.dependencyKeys[e]=[];for(var r=0;r<n.length;r++){var i=n[r];"string"==typeof i?this.dependencies[e].push(i):function(n){var r=_.getKeyVariant(t.monitorKey,"dep:"+e+":"+n);t.dependencyKeys[e].push(r);var a=t.data.addSchemaMatchMonitor(r,i,function(){t.dependencyUpdated(e,n)},!1,!0);t.dependencies[e].push(a)}(r)}},notify:function(){this.monitors.notify(this.match,this.matchFailReason)},setMatch:function(e,t){var n=this,r=this.match,i=this.matchFailReason;return this.match=e,this.matchFailReason=e?null:t,this.impatientCallbacks?this.notify():(this.pendingNotify||(this.pendingNotify=!0,B.add(function(){n.pendingNotify=!1,n.match&&r||(n.match||r||!n.matchFailReason.equals(i))&&n.notify()})),void 0)},subMatchUpdated:function(){this.update()},subMatchRemoved:function(){this.update()},dependencyUpdated:function(){this.update()},update:function(){try{this.matchAgainstBasicTypes(),this.matchAgainstSubMatches(),this.matchAgainstImmediateConstraints(),this.setMatch(!0)}catch(e){if(!(e instanceof L))throw e;this.setMatch(!1,e)}},matchAgainstBasicTypes:function(){for(var e=this.data.basicType(),t=0;t<this.basicTypes.length;t++)if(this.basicTypes[t]==e||"integer"==e&&"number"==this.basicTypes[t])return;throw new L("Data does not match any of the basic types: "+this.basicTypes,this.schema)},matchAgainstSubMatches:function(){for(var e=0;e<this.andMatches.length;e++){var t=this.andMatches[e];if(!t.match){var n="extended schema #"+e+": "+t.message;throw new L(n,this.schema,t.failReason)}}for(var e=0;e<this.notMatches.length;e++){var r=this.notMatches[e];if(r.match){var n='"not" schema #'+e+" matches";throw new L(n,this.schema)}}for(var i in this.xorSelectors){var a=this.xorSelectors[i];if(null==a.selectedOption){var n="XOR #"+i+": "+a.failReason.message;throw new L(n,this.schema,a.failReason)}}for(var i in this.orSelectors){var a=this.orSelectors[i];if(0==a.selectedOptions.length){var n="OR #"+i+": no matches";throw new L(n,this.schema)}}for(var i in this.propertyMatches)for(var s=this.propertyMatches[i],e=0;e<s.length;e++){var o=s[e];if(!o.match){var n=i+": "+o.matchFailReason.message;throw new L(n,this.schema,o.matchFailReason)}}for(var i in this.indexMatches)for(var s=this.indexMatches[i],e=0;e<s.length;e++){var o=s[e];if(!o.match){var n=i+": "+o.matchFailReason.message;throw new L(n,this.schema,o.matchFailReason)}}},matchAgainstImmediateConstraints:function(){this.matchAgainstEnums(),this.matchAgainstNumberConstraints(),this.matchAgainstStringConstraints(),this.matchAgainstArrayConstraints(),this.matchAgainstObjectConstraints()},matchAgainstEnums:function(){var e=this.schema.enumData();if(e.defined()){for(var t=0;t<e.length();t++){var n=e.index(t);if(n.equals(this.data))return}throw new L("Data does not match enum: "+JSON.stringify(e.value())+" ("+JSON.stringify(this.data.value())+")",this.schema)}},matchAgainstNumberConstraints:function(){if("number"==this.data.basicType()||"integer"==this.data.basicType()){var e=this.data.value(),t=this.schema.numberInterval();if(void 0!=t&&0!=e/t%1)throw new L("Number must be multiple of "+t);var n=this.schema.minimum();if(void 0!==n)if(this.schema.exclusiveMinimum()){if(n>=e)throw new L("Number must be > "+n)}else if(n>e)throw new L("Number must be >= "+n);var r=this.schema.maximum();if(void 0!=r)if(this.schema.exclusiveMaximum()){if(e>=r)throw new L("Number must be < "+r)}else if(e>r)throw new L("Number must be <= "+r)}},matchAgainstStringConstraints:function(){if("string"==this.data.basicType()){var e=this.schema.minLength();if(this.data.value().length<e)throw new L("String must be at least "+e+" chars");var t=this.schema.maxLength();if(null!=t&&this.data.value().length>t)throw new L("String must be at most "+t+" chars");var n=this.schema.pattern();if(n&&!n.test(this.data.value()))throw new L("String must match pattern: "+this.schema.patternString())}},matchAgainstArrayConstraints:function(){if("array"==this.data.basicType()){var e=this.schema.minItems();if(void 0!==e&&e>this.data.length())throw new L("Data is not long enough - minimum length is "+e,this.schema);var t=this.schema.maxItems();if(void 0!==t&&t<this.data.length())throw new L("Data is too long - maximum length is "+t,this.schema);if(this.schema.uniqueItems())for(var n=this.data.length(),r=0;n>r;r++)for(var i=r+1;n>i;i++)if(this.data.item(r).equals(this.data.item(i)))throw new L("Items must be unique (items "+r+" and "+i+")",this.schema)}},matchAgainstObjectConstraints:function(){if("object"==this.data.basicType()){for(var e=this.schema.requiredProperties(),t=0;t<e.length;t++){var n=e[t];if(!this.data.property(n).defined())throw new L("Missing key "+JSON.stringify(n),this.schema)}var r=this.data.keys();if(0==this.schema.allowedAdditionalProperties())for(var t=0;t<r.length;t++)if(this.schema.isAdditionalProperty(r[t]))throw new L("Not allowed additional property: "+JSON.stringify(n),this.schema);var i=this.schema.maxProperties();if(null!=i&&r.length>i)throw new L("Too many properties (> "+i+")",this.schema);var a=this.schema.minProperties();if(r.length<a)throw new L("Too few properties (< "+a+")",this.schema);this.matchAgainstDependencies()}},matchAgainstDependencies:function(){for(var e in this.dependencies)if(void 0!=this.data.property(e))for(var t=this.dependencies[e],n=0;n<t.length;n++){var r=t[n];if("string"==typeof r){if(!this.data.property(r).defined())throw new L("Dependency - property "+JSON.stringify(e)+" requires property "+JSON.stringify(r),this.schema)}else if(!r.match)throw new L("Dependency for "+e,this.schema,r.matchFailReason)}}},L.prototype=new Error,L.prototype.toString=function(){return this.message+" in "+this.schema.title()},L.prototype.equals=function(e){if(!(e instanceof L))return!1;if(null==this.subMatchFailReason){if(null!=e.subMatchFailReason)return!1}else if(null==e.subMatchFailReason||!this.subMatchFailReason.equals(e.subMatchFailReason))return!1;return this.message==e.message&&(null==this.schema&&null==e.schema||null!=this.schema&&null!=e.schema&&this.schema.equals(e.schema))},I.prototype={onMatchChange:function(e,t){return this.matchCallback=e,t!==!1&&e.call(this,this.selectedOption),this},update:function(){for(var e=null,t="No matches",n=0;n<this.subMatches.length;n++)if(this.subMatches[n].match){if(null!=e){t="multiple matches",e=null;break}e=this.options[n],t=null}this.failReason=new L(t),this.selectedOption!=e&&(this.selectedOption=e,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOption))}},T.prototype={onMatchChange:function(e,t){return this.matchCallback=e,t!==!1&&e.call(this,this.selectedOptions),this},update:function(){for(var e=[],t=0;t<this.subMatches.length;t++)this.subMatches[t].match&&e.push(this.options[t]);var n=!1;if(e.length!=this.selectedOptions.length)n=!0;else for(var t=0;t<e.length;t++)if(e[t]!=this.selectedOptions[t]){n=!0;break}n&&(this.selectedOptions=e,void 0!=this.matchCallback&&this.matchCallback.call(this,this.selectedOptions))}};var at=[];e.registerSchemaChangeListener=function(e){at.push(e)};var st={},ot=!1;A.prototype={rel:function(e){if(void 0==e)return this;var t,n=[];for(t=0;t<this.length;t++)this[t].rel===e&&(n[n.length]=this[t]);return new A(n)}};var ut={"null":!0,"boolean":!0,integer:!0,number:!0,string:!0,array:!0,object:!0};P.prototype={toString:function(){return"[Jsonary Schema List]"},indexOf:function(e,t){for(var n=this.length-1;n>=0;){if(e.equals(this[n],t))return n;n--}return n},containsUrl:function(e){if(e instanceof RegExp)for(var t=0;t<this.length;t++){var n=this[t];if(e.test(n.referenceUrl(!0)))return!0}else{e.indexOf("#")<0&&(e+="#");for(var t=0;t<this.length;t++){var n=this[t],r=n.referenceUrl(!0);if(null!=r&&r.substring(r.length-e.length)==e)return!0}}return!1},links:function(e){var t,n,r=[];for(t=0;t<this.length;t++){var n=this[t];r=r.concat(n.links())}return this.links=function(e){for(var t=[],n=0;n<r.length;n++){var i=r[n];(void 0==e||i.rel==e)&&t.push(i)}return t},this.links(e)},each:function(e){for(var t=0;t<this.length;t++)e.call(this,t,this[t]);return this},all:function(e){for(var t=0;t<this.length;t++)if(!e(t,this[t]))return!1;return!0},any:function(e){for(var t=0;t<this.length;t++)if(e(t,this[t]))return!0;return!1},concat:function(e){for(var t=[],n=0;n<this.length;n++)t.push(this[n]);for(var n=0;n<e.length;n++)t.push(e[n]);return new P(t)},title:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].title();n&&e.push(n)}return e.join(" - ")},forceTitle:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].forceTitle();n&&e.push(n)}return e.join(" - ")},definedProperties:function(e){if(e)return this.definedProperties(),this.definedProperties(e);var t=!0,n={};this.each(function(e,r){if(t){r.allowedAdditionalProperties()||(t=!1,n={});for(var i=r.definedProperties(),a=0;a<i.length;a++)n[i[a]]=!0}else if(!r.allowedAdditionalProperties()){t=!1;for(var s={},i=r.definedProperties(),a=0;a<i.length;a++)n[i[a]]&&(s[i[a]]=!0);n=s}});var r=Object.keys(n);return i(this,{allowedAdditionalProperties:t}),this.definedProperties=function(e){e=e||[];for(var t=[],n=0;n<r.length;n++)-1==e.indexOf(r[n])&&t.push(r[n]);return t},r.slice(0)},knownProperties:function(e){if(e)return this.knownProperties(),this.knownProperties(e);var t;if(this.allowedAdditionalProperties()){t=this.requiredProperties();for(var n=this.definedProperties(),r=0;r<n.length;r++)-1==t.indexOf(n[r])&&t.push(n[r])}else var t=this.definedProperties();return this.knownProperties=function(e){e=e||[];for(var n=[],r=0;r<t.length;r++)-1==e.indexOf(t[r])&&n.push(t[r]);return n},t.slice(0)},allowedAdditionalProperties:function(){var e=!0;return this.each(function(t,n){e=e&&n.allowedAdditionalProperties()}),i(this,{additionalProperties:e}),e},minProperties:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].minProperties();n>e&&(e=n)}return e},maxProperties:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].maxProperties();n>e||(e=n)}return e},types:function(){for(var e=ut,t=0;t<this.length;t++){for(var n=this[t].basicTypes(),r={},i=0;i<n.length;i++){var a=n[i];e[a]&&(r[a]=!0)}e=r}return Object.keys(e)},numberInterval:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].numberInterval();void 0!=n&&(e=void 0==e?n:_.lcm(e,n))}for(var t=0;t<this.length;t++){for(var r=this[t].basicTypes(),a=!1,s=0;s<r.length;s++){if("number"==r[s]){a=!1;break}"integer"==r[s]&&(a=!0)}if(a)return void 0==e?1:_.lcm(e,1)}return i(this,{numberInterval:e}),e},minimum:function(){for(var e=void 0,t=!1,n=0;n<this.length;n++){var r=this[n].minimum();void 0!=r&&(void 0==e||r>e)&&(e=r,t=this[n].exclusiveMinimum())}return i(this,{minimum:e,exclusiveMinimum:t}),e},exclusiveMinimum:function(){return this.minimum(),this.exclusiveMinimum()},maximum:function(){for(var e=void 0,t=!1,n=0;n<this.length;n++){var r=this[n].maximum();void 0!=r&&(void 0==e||e>r)&&(e=r,t=this[n].exclusiveMaximum())}return i(this,{maximum:e,exclusiveMaximum:t}),e},exclusiveMaximum:function(){return this.minimum(),this.exclusiveMinimum()},minLength:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].minLength();n>e&&(e=n)}return i(this,{minLength:e}),e},maxLength:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].maxLength();n>e||(e=n)}return i(this,{maxLength:e}),e},patterns:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].pattern();n&&e.push(n)}return e},minItems:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].minItems();n>e&&(e=n)}return i(this,{minItems:e}),e},maxItems:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].maxItems();n>e||(e=n)}return i(this,{maxItems:e}),e},tupleTypingLength:function(){for(var e=0,t=0;t<this.length;t++){var n=this[t].tupleTypingLength();n>e&&(e=n)}return e},requiredProperties:function(){for(var e={},t=[],n=0;n<this.length;n++)for(var r=this[n].requiredProperties(),i=0;i<r.length;i++){var a=r[i];e[a]||(e[a]=!0,t.push(a))}return t},readOnly:function(){for(var e=!1,t=0;t<this.length;t++)if(this[t].readOnly()){e=!0;break}return this.readOnly=function(){return e},e},enumDataList:function(){for(var e=void 0,t=0;t<this.length;t++){var n=this[t].enumData();if(n.defined())if(void 0==e)e=[],n.indices(function(t,n){e[t]=n});else{var r=[];n.indices(function(t,n){for(var i=0;i<e.length;i++)e[i].equals(n)&&r.push(n)}),e=r}}return e},enumValues:function(){var e=this.enumDataList();if(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n].value();return t}},allCombinations:function(e){function t(){if(m--,0>=m){for(var t=[new P([])],r=0;r<p.length;r++){for(var i=p[r],a=[],s=0;s<i.length;s++)for(var o=0;o<t.length;o++)a.push(t[o].concat(i[s]));t=a}for(var u=0;u<t.length;u++)t[u]=n.concat(t[u]);e(t)}}if(e&&!this.isFull())return this.getFull(function(t){t.allCombinations(e)}),[];for(var n=this,r=this.xorSchemas(),i=0;i<r.length;i++){for(var a=!1,s=0;s<r[i].length;s++){var o=r[i][s];if(this.indexOf(o,!!e)>=0){a=!0;break}}if(!a){for(var u=[],h=1,l=function(){h--,0>=h&&e(u)},s=0;s<r[i].length;s++){var o=r[i][s];if(e)h++,this.concat([o]).allCombinations(function(e){u=u.concat(e),l()});else{var c=this.concat([o]).allCombinations();u=u.concat(c)}}return e&&l(),u}}for(var d=this.orSchemas(),f=null,p=[],m=1,i=0;i<d.length;i++)!function(r){for(var i=[],a=!1,s=0;s<d[r].length;s++){var o=d[r][s];-1==n.indexOf(o,!!e)?i.push(o):a=!0}if(i.length>0){for(var u=[[]],h=0;h<i.length;h++){for(var l=[],c=0;c<u.length;c++)l.push(u[c]),l.push(u[c].concat([i[h]]));u=l}if(a||u.shift(),e){p[r]=[];for(var f=0;f<u.length;f++){var v=new P(u[f]);m++,v.allCombinations(function(e){p[r]=p[r].concat(e),t()})}}else p[r]=u}}(i);for(var f=[new P([])],v=0;v<p.length;v++){for(var g=p[v],y=[],b=0;b<g.length;b++)for(var S=0;S<f.length;S++)y.push(f[S].concat(g[b]));f=y}for(var i=0;i<f.length;i++)f[i]=this.concat(f[i]);return e&&t(),f},createValue:function(t,n,r,i,a){function s(e){if(void 0!==e){var t=_.guessBasicType(e);-1!=y.indexOf(t)||"integer"==t&&-1!=y.indexOf("number")||(e=void 0)}return void 0!==e&&void 0===S&&(S=e),b--,n&&0>=b&&n(S),0>=b?S:void 0}var o=this;if("function"==typeof t){var u=t;t=n,n=u}if(e.isData(t)&&(t=t.value()),"undefined"==typeof a){if(n)return this.createValue(t,function(e){"undefined"==typeof e?o.createValue(t,n,r,i,!1):n(e)},r,i,!0),void 0;var h=this.createValue(t,n,r,i,!0);return"undefined"==typeof h&&(h=this.createValue(t,n,r,i,!1)),h}if(!i){var l=function(){return l=d,t},c=0,d=function(){for(;c<o.length;){var e=o[c++];if(e.hasDefault())return e.defaultValue()}l=p},f=0,p=function(){for(;f<ht.length;){var e=ht[f++];return e(o)}l=null};if(n){var m=function(e){if("undefined"!=typeof e)return n(e);for(;l;){var t=l();if("undefined"!=typeof t)return o.createValue(t,m,r,!0,a)}a?n(void 0):o.createValue(n,void 0,r,!0,a)};return m(void 0)}for(;l;){var v=l();if("undefined"!=typeof v){var g=this.createValue(v,void 0,r,!0,a);if("undefined"!=typeof g)return g}}return a?void 0:this.createValue(void 0,void 0,r,!0,a)}if(r){var y=this.basicTypes(),b=1,S=void 0,x=this.enumValues();if(void 0!=x){for(var w=0;w<x.length;w++)if(("undefined"==typeof t||_.recursiveCompare(t,x[w]))&&(b++,s(x[w])))return S}else{if("undefined"!=typeof t){var O=_.guessBasicType(t);if("integer"==O){var j=y.indexOf("number");-1!==j&&(y.splice(j,1),y.unshift("number"))}var C=y.indexOf(O);-1!==C&&(y.splice(C,1),y.unshift(O))}for(var w=0;"undefined"==typeof S&&w<y.length;w++){b++;var O=y[w];if("null"==O){if(s(null))return S}else if("boolean"==O){var k=this.createValueBoolean(t,a);if(s(k))return!0}else if("integer"==O||"number"==O){var k=this.createValueNumber(t,a);if(s(k))return S}else if("string"==O){var k=this.createValueString(t,a);if(s(k))return S}else if("array"==O)if(n)this.createValueArray(t,function(e){s(e)},a);else{var k=this.createValueArray(t,void 0,a);if(s(k))return S}else if("object"==O)if(n)var k=this.createValueObject(t,function(e){s(e)},a);else{var k=this.createValueObject(t,void 0,a);if(s(k))return S}}}return s(S)}if(null!=n)return this.allCombinations(function(e){function r(s){return s>=e.length?n(void 0):(e[s].createValue(t,function(e){"undefined"!=typeof e?n(e):r(s+1)},!0,i,a),void 0)}r(0)}),void 0;for(var L=this.allCombinations(),w=0;w<L.length;w++){var h=L[w].createValue(t,void 0,!0,i,a);if(void 0!==h)return h}},createValueBoolean:function(e,t){return void 0===e?!0:t&&"boolean"!=typeof e?void 0:!!e},createValueNumber:function(e,t){if(!t&&"string"==typeof e){var n=parseFloat(e);if(isNaN(n))return void 0;e=n}if("number"==typeof e){if(void 0!=o&&0!=e%o&&(e=Math.round(e/o)*o),(void 0==i||e>i||e==i&&!r)&&(void 0==a||a>e||e==a&&s))return e}else if("undefined"!=typeof e)return void 0;var r=this.exclusiveMinimum(),i=this.minimum(),a=this.maximum(),s=this.exclusiveMaximum(),o=this.numberInterval(),u=void 0;if(void 0!=i&&void 0!=a){if(i>a||i==a&&(r||s))return;if(void 0!=o){if(u=Math.ceil(i/o)*o,r&&u==i&&(u+=o),u>a||u==a&&s)return}else u=.5*(i+a)}else void 0!=i?(u=i,void 0!=o&&(u=Math.ceil(u/o)*o),r&&u==i&&(void 0!=o?u+=o:u++)):void 0!=a?(u=a,void 0!=o&&(u=Math.floor(u/o)*o),s&&u==a&&(void 0!=o?u-=o:u--)):u=0;return u},createValueString:function(e,t){var n=[""];if("undefined"!=typeof e)if("string"==typeof e)n.unshift(e);else{if(t)return void 0;if("number"==typeof e)n.unshift(""+e);else{if("boolean"!=typeof e)return void 0;n.unshift(e?"true":"false")}}var r=this.minLength(),i=this.maxLength(),a=this.patterns();if(null!=i&&r>i)return void 0;for(var s=0;s<n.length;s++){var o=n[s];if(o.length<r){var u="?";o+=new Array(r-o.length+1).join(u)}else o.length>i&&(o=o.substring(0,i));for(var h=0;h<a.length;h++)a[h].test(o);return o}},createValueArray:function(e,t,n){if("function"==typeof e){var r=e;e=t,t=r}if("undefined"!=typeof e&&!Array.isArray(e))return void 0;var i=this,a=[],s=this.minItems(),o=this.maxItems();if(!(null!=o&&s>o)){for(var u=1,h=0;a&&s>h;h++)!function(r){u++;var s=Array.isArray(e)?e[r]:void 0;if(t)i.createValueForIndex(r,s,function(e){"undefined"==typeof e?a=void 0:a&&(a[r]=e),u--,0==u&&t(a)},n||void 0);else{var o=i.createValueForIndex(r,s,void 0,n||void 0);"undefined"==typeof o?a=void 0:a&&(a[r]=o)}}(h);if(a&&Array.isArray(e)){null!=o&&e.length>o?e=e.slice(0,o):o=e.length;for(var h=s;a&&h<=e.length&&o>h;h++)!function(r){u++;var s=Array.isArray(e)?e[r]:void 0;if(t)i.createValueForIndex(r,s,function(e){a&&"undefined"!=typeof e&&o>r?a[r]=e:n?a=void 0:o>r&&(o=r),u--,0==u&&t(a)},n||void 0);else{var h=i.createValueForIndex(r,s,void 0,n||void 0);a&&"undefined"!=typeof h?a[r]=h:n?a=void 0:o>r&&(o=r)}}(h)}return u--,t&&0==u&&t(a),a}},createValueObject:function(e,t,n){if("function"==typeof e){var r=e;e=t,t=r}if("undefined"!=typeof e&&("object"!=typeof e||Array.isArray(e)))return void 0;for(var i=this,a={},s=1,o=this.requiredProperties(),u=0;a&&u<o.length;u++)!function(r){s++;var o="object"!=typeof e||Array.isArray(e)?void 0:e[r];if(t)i.createValueForProperty(r,o,function(e){"undefined"==typeof e?a=void 0:a&&(a[r]=e),s--,0==s&&t(a)},n||void 0);else{var u=i.createValueForProperty(r,o,void 0,n||void 0);"undefined"==typeof u?a=void 0:a&&(a[r]=u)}}(o[u]);if(a&&"object"==typeof e&&!Array.isArray(e))for(var h=this.definedProperties(),u=0;a&&u<h.length;u++){var l=h[u];a&&"undefined"==typeof a[l]&&function(r){var o=e[r];if("undefined"!=typeof o)if(s++,t)i.createValueForProperty(r,o,function(e){a&&"undefined"!=typeof e?a[r]=e:n&&(a=void 0),s--,0==s&&t(a)},n||void 0);else{var u=i.createValueForProperty(r,o,void 0,n||void 0);a&&"undefined"!=typeof u?a[r]=u:n&&(a=void 0)}}(l)}return s--,t&&0==s&&t(a),a},createValueForIndex:function(t,n,r,i){if("function"==typeof n){var a=n;n=r,r=a}e.isData(n)&&(n=n.value());var s=this.indexSchemas(t);return s.createValue(n,r,void 0,void 0,i)},createValueForProperty:function(t,n,r,i){if("function"==typeof n){var a=n;n=r,r=a}e.isData(n)&&(n=n.value());var s=this.propertySchemas(t);return s.createValue(n,r,void 0,void 0,i)},createData:function(t,n,r){var i=this;if("function"==typeof t){var a=t;t=r,r=a}else("function"==typeof n||"boolean"==typeof n)&&(r=n,n=void 0);if(e.isData(t)&&(n=n||t.resolveUrl(""),t==t.value()),r){var s=_.getUniqueKey(),o=e.createSchema({readOnly:!0}),u=e.create("...",n).addSchema(o,s);return this.createValue(t,function(e){B.increment(),u.removeSchema(s),u.setValue(e),u.addSchema(i.fixed()),B.decrement(),"function"==typeof r&&r(u)}),u}return e.create(this.createValue(t),n).addSchema(this.fixed())},indexSchemas:function(e){for(var t=new P,n=0;n<this.length;n++)t=t.concat(this[n].indexSchemas(e));return t},tupleTyping:function(){for(var e=0,t=0;t<this.length;t++)e=Math.max(e,this[t].tupleTyping());return e},uniqueItems:function(){for(var e=!1,t=0;t<this.length;t++)e=e||this[t].uniqueItems();return e},propertySchemas:function(e){for(var t=new P,n=0;n<this.length;n++)t=t.concat(this[n].propertySchemas(e));return t},additionalPropertySchemas:function(e){for(var t=new P,n=0;n<this.length;n++)t=t.concat(this[n].additionalPropertySchemas(e));return t},propertyDependencies:function(e){for(var t=[],n={},r=0;r<this.length;r++)for(var i=this[r].propertyDependencies(e),a=0;a<i.length;a++)"string"==typeof i[a]?n[i[a]]||(n[i[a]]=!0,t.push(i[a])):t.push(i[a]);return t},isFull:function(){for(var e=0;e<this.length;e++){if(!this[e].isFull())return!1;for(var t=this[e].andSchemas(),n=0;n<t.length;n++)if(-1==this.indexOf(t[n],!0))return!1}return!0},getFull:function(e){function t(r){o+=r.length;for(var i=0;i<r.length;i++)r[i].getFull(function(r){for(var i=0;i<n.length;i++)if(r.equals(n[i])){if(o--,0==o){var a=new P(n,u);e.call(a,a)}return}n.push(r);var s=r.extendSchemas();if(t(s),o--,0==o){var a=new P(n,u);e.call(a,a)}})}if(!e){for(var n=[],r=[],i=0;i<this.length;i++){n[i]=this[i].getFull();for(var a=n[i].extendSchemas(),s=0;s<a.length;s++)r.push(a[s])}return new P(n.concat(r))}if(0==this.length)return e.call(this,this),this;var o=0,n=[],u=this.fixed();return t(this),this},formats:function(){for(var e=[],t=0;t<this.length;t++){var n=this[t].format();null!=n&&e.push(n)}return e},containsFormat:function(e){return-1!==this.formats().indexOf(e)},unordered:function(){if(this.tupleTyping())return!1;for(var e=0;e<this.length;e++)if(this[e].unordered())return!0;return!1},xorSchemas:function(){for(var e=[],t=0;t<this.length;t++)e=e.concat(this[t].xorSchemas());return e},orSchemas:function(){for(var e=[],t=0;t<this.length;t++)e=e.concat(this[t].orSchemas());return e}},P.prototype.basicTypes=P.prototype.types,P.prototype.potentialLinks=P.prototype.links,e.extendSchemaList=function(e){for(var t in e)void 0==P.prototype[t]&&(P.prototype[t]=e[t])};var ht=[];e.extendCreateValue=function(e){ht.push(e)},e.createSchemaList=function(e){return Array.isArray(e)||(e=[e]),new P(e)};var lt=_.getUniqueKey(),ct=_.getUniqueKey(),dt=0;E.prototype={update:function(e){this.updateLinksWithKey(e),this.updateDependenciesWithKey(e),this.updateMatchesWithKey(e)},updateFromSelfLink:function(){this.cachedLinkList=null;var e=[];for(var t in this.links){var n=this.links[t];for(i=0;i<n.length;i++){var r=n[i];"self"==r.rel()&&(r.active=!1)}}for(var t in this.links){var n=this.links[t];for(i=0;i<n.length;i++){var r=n[i];"self"==r.rel()&&(r.update(),r.active&&(e.push(r),r.active=!1,this.cachedLinkList=null))}}for(var i=0;i<e.length;i++)e[i].active=!0;for(var t in this.links){var n=this.links[t];for(i=0;i<n.length;i++){var r=n[i];"self"!=r.rel()&&r.update()}}this.dataObj.properties(function(e,t){t.addLink(null)}),this.dataObj.items(function(e,t){t.addLink(null)})},updateLinksWithKey:function(e){var t,n,r,i,a=[];for(t in this.links)for(r=this.links[t],n=0;n<r.length;n++)i=r[n],(i.usesKey(e)||null==e)&&a.push(i);if(a.length>0){var s=null;for(n=0;n<a.length;n++){i=a[n];var o=i.active?i.rawLink.rawLink.href:null;i.update();var u=i.active?i.rawLink.rawLink.href:null;if(u!=o&&"self"==i.rel()){s=i;break}}null!=s&&this.updateFromSelfLink(s),this.invalidateSchemaState()}},updateMatchesWithKey:function(e){var t=[];for(schemaKey in this.matches)t.push(schemaKey);t.sort(),t.reverse();for(var n=0;n<t.length;n++){var r=this.matches[t[n]];if(void 0!=r)for(var i=0;i<r.length;i++)r[i].dataUpdated(e)}},updateDependenciesWithKey:function(e){var t=[];for(schemaKey in this.dependencySelectors)t.push(schemaKey);t.sort(),t.reverse();for(var n=0;n<t.length;n++)for(var r=this.dependencySelectors[t[n]],i=0;i<r.length;i++)r[i].dataUpdated(e)},alreadyContainsSchema:function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(void 0!=this.schemas[r])for(var i=0;i<this.schemas[r].length;i++){var a=this.schemas[r][i];if(e.equals(a))return!0}}return!1},addSchema:function(t,n,r,i){var a=this;void 0==n&&(n=_.getUniqueKey(),dt=0),void 0==i&&(i=!0),void 0==r?r=[n]:r[r.length]=n,void 0==this.schemas[n]&&(this.schemas[n]=[]),this.schemaFlux++,"string"==typeof t&&(t=e.createSchema({$ref:t})),t.getFull(function(e){if(a.alreadyContainsSchema(e,r))return a.schemaFlux--,a.checkForSchemasStable(),void 0;B.increment(),i&&a.validation&&a.validation.addSchema(e,n),a.schemas[n].push(e),a.schemasFixed[n]=a.schemasFixed[n]||i,a.dataObj.properties(function(t,i){for(var a=_.getKeyVariant(n,"prop"),s=e.propertySchemas(t),o=0;o<s.length;o++)i.addSchema(s[o],a,r)}),a.dataObj.indices(function(t,i){_.getKeyVariant(n,"idx");for(var a=e.indexSchemas(t),t=0;t<a.length;t++)i.addSchema(a[t],n,r)});for(var t=e.extendSchemas(),s=0;s<t.length;s++)a.addSchema(t[s],n,r,i);a.addLinks(e.links(),n,r),a.addXorSelectors(e,n,r),a.addOrSelectors(e,n,r),a.addDependencySelector(e,n,r),a.schemaFlux--,a.invalidateSchemaState(),B.decrement()})},addLinks:function(e,t,n){var r,i;void 0==this.links[t]&&(this.links[t]=[]);var a=null;for(r=0;r<e.length;r++)i=new M(this.dataObj,e[r]),this.links[t].push(i),this.addMonitorForLink(i,t,n),i.update(),i.active&&"self"==i.rawLink.rawLink.rel&&(a=i);null!=a&&this.updateFromSelfLink(a),this.invalidateSchemaState()},addXorSelectors:function(e,t,n){for(var r=e.xorSchemas(),i=[],a=0;a<r.length;a++){var s=new D(r[a],_.getKeyVariant(t,"xor"+a),n,this);i.push(s)}this.xorSelectors[t]=void 0==this.xorSelectors[t]?i:this.xorSelectors[t].concat(i)},addOrSelectors:function(e,t,n){for(var r=e.orSchemas(),i=[],a=0;a<r.length;a++){var s=new F(r[a],_.getKeyVariant(t,"or"+a),n,this);i.push(s)}this.orSelectors[t]=void 0==this.orSelectors[t]?i:this.orSelectors[t].concat(i)},addDependencySelector:function(e,t,n){var r=new N(e,_.getKeyVariant(t,"dep"),n,this),i=[r];this.dependencySelectors[t]=void 0==this.dependencySelectors[t]?i:this.dependencySelectors[t].concat(i)},addLink:function(t){if(null==t)return this.updateFromSelfLink(),this.invalidateSchemaState(),void 0;if("invalidate"==t.rel||"invalidates"==t.rel){var n=this.dataObj.resolveUrl(t.href);return e.invalidate(n),void 0}var r=lt,i=e.create(t),a=new O(i);this.addLinks([a],r)},addMonitorForLink:function(t,n,r){var i=this,a=t.rel();if("describedby"===a){var s=null,o=_.getKeyVariant(n);t.addMonitor(o,function(a){var u=t.rawLink,h=a?u.href:null;if(s!==h&&(s=h,i.removeSchema(o),a)){var l=e.createSchema({$ref:s});i.addSchema(l,o,r,n==lt)}})}},addSchemaMatchMonitor:function(e,t,n,r,i){var a=new k(e,this.dataObj,t,i);return void 0==this.matches[e]&&(this.matches[e]=[]),this.matches[e].push(a),a.addMonitor(n,r),a},validate:function(){this.validation=new H(this);for(var e in this.schemas)if(this.schemasFixed[e])for(var t=0;t<this.schemas[e].length;t++)this.validation.addSchema(this.schemas[e][t],e);var n=this.validation.publicVersion;return i(this,{validate:n}),n},removeSchema:function(e){this.validation&&this.validation.removeSchema(e),B.increment(),this.dataObj.indices(function(t,n){n.removeSchema(e)}),this.dataObj.properties(function(t,n){n.removeSchema(e)});var t,n,r=[];for(t in this.schemas)_.keyIsVariant(t,e)&&r.push(t);for(t in this.links)_.keyIsVariant(t,e)&&r.push(t);for(t in this.matches)_.keyIsVariant(t,e)&&r.push(t);for(n=0;n<r.length;n++)t=r[n],delete this.schemas[t],delete this.links[t],delete this.matches[t],delete this.xorSelectors[t],delete this.orSelectors[t],delete this.dependencySelectors[t];r.length>0&&this.invalidateSchemaState(),B.decrement()},clear:function(){this.schemas={},this.links={},this.matches={},this.invalidateSchemaState()},getSchemas:function(){if(null!==this.cachedSchemaList)return this.cachedSchemaList;var e,t,n,r,i,a,s=[],o={};for(n in this.schemas){r=this.schemas[n];var u=this.schemasFixed[n];for(e=0;e<r.length;e++){for(i=r[e],u&&(o[i.data.uniqueId]=i),a=!1,t=0;t<s.length;t++)if(i.equals(s[t])){a=!0;break}a||s.push(i)}}var h=[];for(var n in o)h.push(o[n]);return this.cachedSchemaList=new P(s,h),this.cachedSchemaList},getLinks:function(e){var t,n,r,i;if(null!==this.cachedLinkList)return this.cachedLinkList.rel(e);var a=[];for(t in this.links)for(i=this.links[t],n=0;n<i.length;n++)r=i[n],r.active&&a.push(r.rawLink);return this.cachedLinkList=new A(a),this.cachedLinkList.rel(e)},invalidateSchemaState:function(){this.cachedSchemaList=null,this.cachedLinkList=null,this.schemasStable=!1,this.checkForSchemasStable()},checkForSchemasStable:function(){if(this.schemaFlux>0)return!1;var e,t,n,r;for(t in this.schemas)for(n=this.schemas[t],e=0;e<n.length;e++)if(r=n[e],!r.isComplete())return this.schemasStable=!1,!1;var i=this;return i.schemasStable||(i.schemasStable=!0,V(i.dataObj)),B.add(function(){i.schemasStableListeners.notify(i.dataObj,i.getSchemas())}),!0},addSchemasForProperty:function(e,t){for(var n in this.schemas)for(var r=_.getKeyVariant(n,"prop"),i=0;i<this.schemas[n].length;i++)for(var a=this.schemas[n][i],s=a.propertySchemas(e),o=0;o<s.length;o++)t.addSchema(s[o],r)},addSchemasForIndex:function(e,t){for(var n in this.schemas)for(var r=_.getKeyVariant(n,"idx"),i=0;i<this.schemas[n].length;i++)for(var a=this.schemas[n][i],s=a.indexSchemas(e),o=0;o<s.length;o++)t.addSchema(s[o],r)
},removeSubSchemas:function(e){for(var t in this.schemas)e.removeSchema(t)},whenSchemasStable:function(e){this.schemasStableListeners.add(e),this.checkForSchemasStable()}},M.prototype={update:function(){var e=this.potentialLink.canApplyTo(this.dataObj);e?(this.rawLink=this.potentialLink.linkForData(this.dataObj),"self"==this.potentialLink.rel()&&this.dataObj.document.addSelfLink(this)):this.rawLink&&("self"==this.potentialLink.rel()&&this.dataObj.document.removeSelfLink(this),this.rawLink=null),this.active=e,this.updateMonitors.notify(this.active)},rel:function(){return this.potentialLink.rel()},usesKey:function(e){return this.potentialLink.usesKey(e)},addMonitor:function(e,t){this.updateMonitors.add(e,t)}},N.prototype={dataUpdated:function(e){if(null!=e)if(this.schemaSet.dataObj.property(e).defined())for(var t=this.schema.propertyDependencies(e),n=0;n<t.length;n++){var r=t[n];"string"!=typeof r&&this.schemaSet.addSchema(r,this.inferredSchemaKeys[e],this.schemaKeyHistory,!1)}else this.schemaSet.removeSchema(this.inferredSchemaKeys[e]);else for(var i=this.schema.data.property("dependencies").keys(),n=0;n<i.length;n++){var e=i[n];this.dataUpdated(e)}}},U.prototype={},H.prototype={addSchema:function(e,t){var n=this,r=_.getKeyVariant(ct+"."+t);this.matchErrors[r]=[];var i=this.schemaSet.addSchemaMatchMonitor(r,e,function(){n.updateMatch(i,r)},!1);this.updateMatch(i,r)},removeSchema:function(e){var t=ct+"."+e;delete this.matchErrors[t]},updateMatch:function(e,t){this.matchErrors[t]=[],e.match||this.matchErrors[t].push(e.matchFailReason),this.updateMonitors.notify(e,t)}},e.config={antiCacheUrls:!1,accessImmediately:!1,debug:!1},e.UriTemplate=K}(this.Jsonary={}),function(e){function t(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function n(e){e=e||10;for(var t="";t.length<e;)t+=y.charAt(Math.floor(Math.random()*y.length));return t}function r(e){if(b)return e();b=!0;var t=document.documentElement,n=document.body,r=t&&t.scrollLeft||n&&n.scrollLeft||0,i=t&&t.scrollTop||n&&n.scrollTop||0;e(),setTimeout(function(){(r||i)&&window.scrollTo(r,i),b=!1},10)}function i(){var e={};this.get=function(t){return e[t]},this.set=function(t,n){return e[t]=n}}function a(e){this.uniqueId=j++;var a=this;this.elementLookup={},void 0==e&&(e=S+"."+x++ +n(4)+".");var s=0;this.getElementId=function(){return e+s++},this.enhancementContexts={},this.enhancementActions={},this.enhancementInputs={},"undefined"!=typeof document&&(g.registerChangeListener(function(e,t){e.each(function(e,n){for(var r=t.affectedData(n),i=0;i<r.length;i++)a.update(r[i],n)})}),g.registerSchemaChangeListener(function(e){for(var n={},i=0;i<e.length;i++){var s=e[i],u=s.uniqueId,h=a.elementLookup[u];n[u]=h?h.slice(0):[]}for(var l=0;l<e.length;l++)for(var s=e[l],u=s.uniqueId,h=n[u],i=0;i<h.length;i++){var c=o.getElementById(h[i]);if(void 0!=c){var d=c.jsonaryContext,f=t(this.uiStartingState),p=v(s,f,d.missingComponents,d.bannedRenderers);r(function(){p.uniqueId==d.renderer.uniqueId?p.render(c,s,d):d.baseContext.render(c,s,d.label,f)})}}})),this.rootContext=this,this.subContexts={},this.oldSubContexts={},this.missingComponents=O,this.bannedRenderers={};var u=new i;this.set=u.set,this.get=u.get}function s(){var e=[];for(var t in C.elementLookup){for(var n=C.elementLookup[t],r=!1,i=0;i<n.length;i++){var a=o.getElementById(n[i]);if(a){r=!0;break}}r||e.push(t)}for(var i=0;i<e.length;i++)delete C.elementLookup[e[i]];for(var t in C.enhancementContexts)if(C.enhancementContexts[t]){var s=C.enhancementContexts[t];g.log(g.logLevel.WARNING,"Orphaned context for element: "+JSON.stringify(t)+"\renderer:"+s.renderer.name+"\ncomponents:"+s.renderer.filterObj.component.join(", ")+"\ndata: "+s.data.json()),C.enhancementContexts[t]=null}for(var t in C.enhancementActions)if(C.enhancementActions[t]){var s=C.enhancementActions[t].context;g.log(g.logLevel.WARNING,"Orphaned action for element: "+JSON.stringify(t)+"\renderer:"+s.renderer.name+"\ncomponents:"+s.renderer.filterObj.component.join(", ")+"\ndata: "+s.data.json()),C.enhancementActions[t]=null}for(var t in C.enhancementInputs)if(C.enhancementInputs[t]){var s=C.enhancementInputs[t].context;g.log(g.logLevel.WARNING,"Orphaned action for input: "+JSON.stringify(t)+"\renderer:"+s.renderer.name+"\ncomponents:"+s.renderer.filterObj.component.join(", ")+"\ndata: "+s.data.json()),C.enhancementInputs[t]=null}}function o(e,t,n,r){r=r||{},"string"==typeof e&&(e=o.getElementById(e));var i=document.createElement("span");i.className="jsonary",e.innerHTML="",e.appendChild(i);var a=C;return r.withComponent&&(a=a.withComponent(r.withComponent)),r.withoutComponent&&(a=a.withoutComponent(r.withoutComponent)),a=a.subContext(Math.random()),C.oldSubContexts={},C.subContexts={},a.render(i,t,"render",n)}function u(e,t,n){n=n||{};var r=C;n.withComponent&&(r=r.withComponent(n.withComponent)),n.withoutComponent&&(r=r.withoutComponent(n.withoutComponent));var i=r.renderHtml(e,null,t);return C.oldSubContexts={},C.subContexts={},'<span class="jsonary">'+i+"</span>"}function h(e){if("string"==typeof e){var t=e;if(e=o.getElementById(t),!e)throw new Error("Element not found: "+t)}C.enhanceElement(e)}function l(e,t,n,r){if("string"==typeof r){var i=document.getElementById(r)||document.getElementsByName(r)[0];r=!i||function(e){i.value=JSON.stringify(e)}}var a=g.create(t).addSchema(g.createSchema(n));return"function"==typeof r?a.document.registerChangeListener(function(){r(a.value())}):r||(a=a.readOnlyCopy()),g.render(e,a)}function c(e,t,n,r){"function"==typeof n&&(r=n,n=null),n=n||{},"object"==typeof r&&(n=r,r=arguments[3]);var i=C;return n.withComponent&&(i=i.withComponent(n.withComponent)),n.withoutComponent&&(i=i.withoutComponent(n.withoutComponent)),i.asyncRenderHtml(e,null,t,function(e,t,n){c.postTransform(e,t,n,r)})}function d(e){if(this.renderFunction=e.render||e.enhance,this.renderHtmlFunction=e.renderHtml,this.updateFunction=e.update,"function"==typeof e.filter?(this.filterFunction=e.filter,this.filterObj={}):(this.filterObj=e.filter||{},this.filterFunction=this.filterObj.filter),this.filterObj.schema){var t=Array.isArray(this.filterObj.schema)?this.filterObj.schema:[this.filterObj.schema];this.filterFunction=function(e){return function(n,r){for(var i=0;i<t.length;i++)if(r.containsUrl(t[i]))return e?e.apply(this,arguments):!0;return!1}}(this.filterFunction)}this.actionFunction="object"==typeof e.action?function(t,n){if("function"==typeof e.action[n]){for(var r=[];r.length<arguments.length;)r[r.length]=arguments[r.length];return r[1]=t,r[0]=t.data,e.action[n].apply(this,r)}return"function"==typeof e.action._super?e.action._super.apply(this,arguments):void 0}:e.action,this.linkHandler=function(){return e.linkHandler?e.linkHandler.apply(this,arguments):void 0};for(var n in e)void 0==this[n]&&(this[n]=e[n]);this.uniqueId=k++,this.name=e.name||"#"+this.uniqueId;var r=e.component||this.filterObj.component;void 0==r&&(r=O[O.length-1]),"string"==typeof r&&(r=[r]),this.component=this.filterObj.component=r,(e.saveState||e.saveUiState)&&(this.saveUiState=e.saveState||e.saveUiState),(e.loadState||e.loadUiState)&&(this.loadUiState=e.loadState||e.loadUiState)}function f(e){var t=new d(e);L[t.uniqueId]=t;var n=t.filterObj.readOnly,r=t.filterObj.type||["undefined","null","boolean","integer","number","string","object","array"],i=t.filterObj.component;Array.isArray(r)||(r=[r]),-1!==r.indexOf("number")&&-1===r.indexOf("integer")&&r.push("integer");for(var a=0;a<r.length;a++){var s=r[a];if(!I[s])throw new Error("Invalid type(s): "+s);if(n||"undefined"==typeof n)for(var o=I[s],u=0;u<i.length;u++){var h=i[u];o[h]=o[h]||[],o[h].push(t)}if(!n)for(var o=T[s],u=0;u<i.length;u++){var h=i[u];o[h]=o[h]||[],o[h].push(t)}}return t}function p(e){"object"==typeof e&&(e=e.uniqueId),delete L[e];for(var t=0;2>t;t++){var n=t?T:I;for(var r in n)for(var i in n[r])for(var a=n[r][i],t=0;t<a.length;t++)a[t].uniqueId==e&&(a.splice(t,1),t--)}}function m(e,t,n,r){r=!!r||void 0==r;for(var i=0;i<V.length;i++){var a=V[i],s=a(e,t,n,r);if(s===!1)break}}function v(e,t,n,r){for(var i=e.schemas(),a=e.basicType(),s=e.readOnly(),o=s?I:T,u=0;u<n.length;u++){var h=n[u],l=o[a];if(l[h])for(var c=l[h],d=c.length-1;d>=0;d--){var f=c[d];if(!r[f.uniqueId]&&f.canRender(e,i,t))return f}}}var g=e.Jsonary;g.config.checkTagParity=["div","span"];var y="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",b=!1,S="Jsonary",x=0,w={ADD_REMOVE:"ADD_REMOVE",TYPE_SELECTOR:"TYPE_SELECTOR",RENDERER:"DATA_RENDERER",add:function(e,t){if(void 0!=this[e]){if(void 0===t)return;-1!=O.indexOf(e)&&O.splice(O.indexOf(e),1)}if(this[e]=e,t!==!1){if("number"==typeof t){var n=Math.max(0,Math.min(O.length-1,Math.round(t)));O.splice(n,0,this[e])}else-1!=O.indexOf(t)?O.splice(O.indexOf(t),0,this[e]):-1!=O.indexOf(w[t])?O.splice(O.indexOf(w[t]),0,this[e]):O.splice(O.length-1,0,this[e]);return e}}},O=[w.ADD_REMOVE,w.TYPE_SELECTOR,w.RENDERER],j=0;a.prototype={toString:function(){return"[Jsonary RenderContext]"},rootContext:null,baseContext:null,labelSequence:function(){return this.parent&&this.parent.parent&&this.parent!=C?this.parent.labelSequence().concat([this.label]):[]},labelSequenceContext:function(e){for(var t=this,n=0;n<e.length;n++){var r=e[n];if(t=t.subContexts[r]||t.oldSubContexts[r],!t)return null}return t},labelForData:function(e){if(this.data&&e.document.isDefinitive){var t=e.getLink("self"),n=t?t.href:e.referenceUrl();if(n){for(var r=this.data.referenceUrl()||this.data.resolveUrl(""),i=0;n.substring(0,r.length-i)!=r.substring(0,r.length-i);)i++;var a=n.substring(r.length-i);return i?i+"!"+a:"!"+a}}else if(this.data&&this.data.document==e.document){for(var s=this.data.pointerPath(),o=e.pointerPath(),i=0;o.substring(0,s.length-i)!=s.substring(0,s.length-i);)i++;var a=o.substring(s.length-i);return i?i+"!"+a:"!"+a}return this.renderer&&g.log(g.logLevel.WARNING,"No label supplied for data in renderer "+JSON.stringify(this.renderer.name)),"$"+e.uniqueId},subContext:function(e,t){g.isData(e)&&(e=this.labelForData(e)),t=t||{};var n=this.getSubContext(!1,this.data,e,t);return n.renderer=this.renderer,n.uiState||n.loadState(n.uiStartingState),n},subContextSavedStates:{},saveUiState:function(){var e={};for(var t in this.subContexts)e[t]=this.subContexts[t].saveUiState();for(var t in this.oldSubContexts)e[t]=this.oldSubContexts[t].saveUiState();var n=this.renderer?this.renderer.saveUiState:d.prototype.saveUiState;return n.call(this.renderer,this.uiState,e,this.data)},loadUiState:function(e){var t=this.renderer?this.renderer.loadUiState:d.prototype.loadUiState,n=t.call(this.renderer,e);this.uiState=n[0],this.subContextSavedStates=n[1]},withSameComponents:function(){if(missingComponents=this.missingComponents.slice(0),void 0!=this.renderer)for(var e=0;e<this.renderer.filterObj.component.length;e++){var t=missingComponents.indexOf(this.renderer.filterObj.component[e]);-1!==t&&missingComponents.splice(t,1)}return this.withComponent(missingComponents)},withComponent:function(e){Array.isArray(e)||(e=[e]);var t=this.getSubContext,n=Object.create(this);return n.getSubContext=function(){for(var n=t.apply(this,arguments),r=e.length;r>=0;r--){var i=n.missingComponents.indexOf(e[r]);-1!==i&&n.missingComponents.splice(i,1),n.missingComponents.unshift(e[r])}return n},n},withoutComponent:function(e){Array.isArray(e)||(e=[e]);var t=this.getSubContext,n=Object.create(this);return n.getSubContext=function(){for(var n=t.apply(this,arguments),r=0;r<e.length;r++){var i=n.missingComponents.indexOf(e[r]);-1!==i&&n.missingComponents.splice(i,1)}return n},n},getSubContext:function(e,n,r,a){function s(e,n,r,a,s,o,u){this.uniqueId=j++,this.rootContext=e,this.baseContext=n,this.label=r,this.data=a,this.uiStartingState=t(s||{}),this.missingComponents=o,this.subContexts={},this.oldSubContexts={},this.bannedRenderers=u;var h=new i;this.set=h.set,this.get=h.get}if("object"==typeof r&&null!=r)throw new Error("Label cannot be an object");if(r||""===r)var o=r;else var o=this.labelForData(n);if(void 0!=this.oldSubContexts[o]&&(this.subContexts[o]=this.oldSubContexts[o]),void 0!=this.subContexts[o]&&(null===n||null===this.subContexts[o].data?this.subContexts[o].data=n:this.subContexts[o].data!=n&&(delete this.subContexts[o],delete this.oldSubContexts[o],delete this.subContextSavedStates[o])),this.subContextSavedStates[o]&&(a=this.subContextSavedStates[o],delete this.subContextSavedStates[o]),void 0==this.subContexts[o]){var u,h;if(this.data==n){if(u=this.missingComponents.slice(0),h=Object.create(this.bannedRenderers),void 0!=this.renderer){for(var l=0;l<this.renderer.filterObj.component.length;l++){var c=u.indexOf(this.renderer.filterObj.component[l]);-1!==c&&u.splice(c,1)}h[this.renderer.uniqueId]=!0}}else u=O.slice(0),h={};"object"==typeof e&&(e=e.id),s.prototype=this.rootContext,this.subContexts[o]=new s(this.rootContext,this,o,n,a,u,h)}var d=this.subContexts[o];return d.elementId=e,d.parent=this,d},clearOldSubContexts:function(){this.oldSubContexts=this.subContexts,this.subContexts={}},rerender:function(){if(this.parent&&!this.elementId)return this.parent.rerender();var e=o.getElementById(this.elementId);null!=e&&r(function(){this.renderer.render(e,this.data,this),this.clearOldSubContexts()}.bind(this))},asyncRerenderHtml:function(e){var t=this;void 0==this.uiState&&this.loadState(this.uiStartingState);var n=this.renderer;this.data.whenStable(function(r){n.asyncRenderHtml(r,t,function(n,r){n||t.clearOldSubContexts(),c.postTransform(n,r,t,e)})})},render:function(e,t,n,r){if(void 0==r&&"object"==typeof n&&(r=n,n=null),"string"==typeof t&&(t=g.getData(t)),void 0!=t.getData){var i=this;e.innerHTML='<div class="loading"></div>';var a=this.getSubContext(e.id,null,n,r);return t.getData(function(t){i.render(e,t,n,r)}),a}"object"!=typeof r&&(r={}),(void 0==e.id||""==e.id)&&(e.id=this.getElementId());var s=e.jsonaryContext,a=this.getSubContext(e.id,t,n,r);if(e.jsonaryContext=a,s){var o=s.data.uniqueId,u=this.elementLookup[o].indexOf(e.id);u>=0&&this.elementLookup[o].splice(u,1)}var h=t.uniqueId;void 0==this.elementLookup[h]&&(this.elementLookup[h]=[]),-1==this.elementLookup[h].indexOf(e.id)&&this.elementLookup[h].push(e.id);var l=v(t,r,a.missingComponents,a.bannedRenderers);return void 0!=l?(a.renderer=l,void 0==a.uiState&&a.loadState(a.uiStartingState),l.render(e,t,a),a.clearOldSubContexts()):e.innerHTML="NO RENDERER FOUND",a},renderHtml:function(e,t,n){void 0==n&&"object"==typeof t&&(n=t,t=null);var r=this.getElementId();if("string"==typeof e&&(e=g.getData(e)),void 0!=e.getData){var i=this,a=!1;if(e.getData(function(s){if(a){var u=o.getElementById(r);u?i.render(u,s,t,n):g.log(g.logLevel.WARNING,"Attempted delayed render to non-existent element: "+r)}else a=!0,e=s}),!a)return a=!0,'<span id="'+r+'"><div class="loading"></div></span>'}n===!0&&(n=this.uiStartingState),"object"!=typeof n&&(n={});var s=this.getSubContext(r,e,t,n),u=v(e,n,s.missingComponents,s.bannedRenderers);s.renderer=u,void 0==s.uiState&&s.loadState(s.uiStartingState);var h=u.renderHtml(e,s);s.clearOldSubContexts();var l=e.uniqueId;return void 0==this.elementLookup[l]&&(this.elementLookup[l]=[]),-1==this.elementLookup[l].indexOf(r)&&this.elementLookup[l].push(r),this.addEnhancement(r,s),'<span id="'+r+'">'+h+"</span>"},asyncRenderHtml:function(e,t,n,r){var i=this;void 0==n&&"object"==typeof t&&(n=t,t=null);var a=this.getElementId();if("string"==typeof e&&(e=g.getData(e)),void 0!=e.getData){t=t||"async"+Math.random();var s=this.getSubContext(a,null,t,n);return e.getData(function(e){i.asyncRenderHtml(e,t,n,r)}),s}n===!0&&(n=this.uiStartingState),"object"!=typeof n&&(n={});var s=this.getSubContext(a,e,t,n),o=v(e,n,s.missingComponents,s.bannedRenderers);return s.renderer=o,void 0==s.uiState&&s.loadState(s.uiStartingState),e.whenStable(function(){o.asyncRenderHtml(e,s,function(e,t){s.clearOldSubContexts(),r(null,t,s)})}),s},update:function(e,n){var i=e.uniqueId,a=this.elementLookup[i];if(void 0!=a&&0!=a.length)for(var a=a.slice(0),s=0;s<a.length;s++){var u=o.getElementById(a[s]);if(void 0!=u){var h=u.jsonaryContext||this.enhancementContexts[a[s]],l=t(this.uiStartingState),c=v(e,l,h.missingComponents,h.bannedRenderers);c.uniqueId==h.renderer.uniqueId?c.update(u,e,h,n):r(function(){h.baseContext.render(u,e,h.label,l)})}}},actionHtml:function(e,t){var n=2,r=!1,i=null;"object"==typeof t?(r=t.historyChange||!1,i=t.linkUrl||null,t=t.actionName):"boolean"==typeof t&&(r=arguments[1],i=arguments[2]||null,t=arguments[3],n+=2);for(var a=[],s=n;s<arguments.length;s++)a.push(arguments[s]);var o=this.getElementId();this.addEnhancementAction(o,t,this,a,r);var u={context:this,linkUrl:i,actionName:t,params:a,historyChange:r};return u.linkUrl=i||g.render.actionUrl(u),g.render.actionHtml(o,e,u)},inputNameForAction:function(e){var t=!1,n=1;"boolean"==typeof e&&(t=e,e=arguments[1],n++);for(var r=[],i=n;i<arguments.length;i++)r.push(arguments[i]);var a={context:this,actionName:e,params:r},s=g.render.actionInputName(a);return this.enhancementInputs[s]={inputName:s,actionName:e,context:this,params:r,historyChange:t},s},addEnhancement:function(e,t){this.enhancementContexts[e]=t},addEnhancementAction:function(e,t,n,r,i){null==r&&(r=[]),this.enhancementActions[e]={actionName:t,context:n,params:r,historyChange:i}},enhanceElement:function(e){for(var t=e;e;)if(e.firstChild)e=e.firstChild;else{for(;!e.nextSibling&&e!=t;)1==e.nodeType&&this.enhanceElementSingle(e),e=e.parentNode;if(1==e.nodeType&&this.enhanceElementSingle(e),e==t)break;if(e.parentNode!=e.nextSibling.parentNode)throw new Error("DOM mismatch - did you forget a close tag? "+e.innerHTML);e=e.nextSibling}},action:function(){for(var e=[this],t=0;t<arguments.length;t++)e.push(arguments[t]);return this.renderer.action.apply(this.renderer,e)},actionArgs:function(e,t){return t=[this,e].concat(t||[]),this.renderer.action.apply(this.renderer,t)},enhanceElementSingle:function(e){var t=e.id,n=this.enhancementContexts[t];if(void 0!=n){e.jsonaryContext=n,delete this.enhancementContexts[t];var r=n.renderer;void 0!=r&&r.enhance(e,n.data,n)}var i=this.enhancementActions[e.id];void 0!=i&&(delete this.enhancementActions[e.id],e.onclick=function(){i.context.elementId;var e=i.context,t=[i.actionName].concat(i.params);return e.action.apply(e,t)&&e.rerender(),m(e.data,e,i.actionName,i.historyChange),!1});var a=this.enhancementInputs[e.name];void 0!=a&&(delete this.enhancementInputs[e.name],e.onchange=function(){var e=this.value;if("checkbox"==this.getAttribute("type")&&(e=this.checked),"select"==this.tagName.toLowerCase()&&null!=this.getAttribute("multiple")){e=[];for(var t=0;t<this.options.length;t++){var n=this.options[t];n.selected&&e.push(n.value)}}a.context.elementId;var r=a.context,i=[a.actionName,e].concat(a.params);r.action.apply(r,i)&&r.rerender(),m(r.data,r,a.actionName,a.historyChange)}),e=null}},a.prototype.saveState=a.prototype.saveUiState,a.prototype.loadState=a.prototype.loadUiState;var C=new a;"undefined"!=typeof document&&setInterval(s,3e4),"undefined"!=typeof document&&(g.cleanup=s),c.postTransform=function(e,t,n,r){return e||(t='<span class="jsonary">'+t+"</span>"),r(e,t,n,r)},o.empty=void 0!=e.jQuery?function(t){e.jQuery(t).empty()}:function(e){e.innerHTML=""},o.Components=w,o.actionInputName=function(e){var t=e.context;return t.getElementId()},o.actionUrl=function(){return"javascript:void(0)"},o.actionHtml=function(e,t,n){return'<a href="'+g.escapeHtml(n.linkUrl)+'" id="'+e+'" class="jsonary-action">'+t+"</a>"},o.rendered=function(e){var t=e.uniqueId;if(!C.elementLookup[t])return!1;for(var n=C.elementLookup[t],r=0;r<n.length;r++){var i=n[r],a=o.getElementById(i);if(a)return!0}return!1},o.saveData=function(e,t){if("undefined"==typeof localStorage)return"LOCALSTORAGE_MISSING";for(var n=(new Date).getTime()-72e5,r=Object.keys(localStorage),i=0;i<r.length;i++){var a=r[i];try{var s=JSON.parse(localStorage[a]);s.accessed<n&&delete localStorage[a]}catch(o){}}return localStorage[e.saveStateId]=JSON.stringify({accessed:(new Date).getTime(),data:e.deflate()}),t},o.loadData=function(e){if("undefined"==typeof localStorage)return void 0;var t=localStorage[e];return t?(t=JSON.parse(t),g.inflate(t.data)):void 0};var k=0;d.prototype={toString:function(){return"[Jsonary Renderer]"},updateAll:function(){var e=[];for(var t in C.elementLookup)e=e.concat(C.elementLookup[t]);for(var n=0;n<e.length;n++){var r=o.getElementById(e[n]);if(void 0!=r){var i=r.jsonaryContext;(i.renderer.uniqueId=this.uniqueId)&&i.rerender()}}},render:function(e,t,n){return null==e?(g.log(g.logLevel.WARNING,"Attempted to render to non-existent element.\n	Data path: "+t.pointerPath()+"\n	Document: "+t.document.url),this):(void 0!=e[0]&&(e=e[0]),o.empty(e),e.innerHTML=this.renderHtml(t,n),null!=this.renderFunction&&this.renderFunction(e,t,n),n.enhanceElement(e),this)},renderHtml:function(e,t){var n="";if(void 0!=this.renderHtmlFunction&&(n=this.renderHtmlFunction(e,t),g.config.debug))for(var r=0;r<g.config.checkTagParity.length;r++){var i=g.config.checkTagParity[r],a=n.match(new RegExp("<s*"+i,"gi")),s=n.match(new RegExp("</s*"+i,"gi"));!a||s&&a.length==s.length||(g.log(g.logLevel.ERROR,"<"+i+"> mismatch in: "+this.name),n='<div class="error">&lt;'+i+"&gt; mismatch in "+g.escapeHtml(this.name)+"</div>")}return n},asyncRenderHtml:function(e,t,n){function r(e){var t=Object.create(e);return t.renderHtml=u,t.subContext=function(){return r(e.subContext.apply(this,arguments))},t}function i(){if(s--,!(s>0)){for(var e in o)a=a.replace(e,o[e]);n(null,a,t)}}var a="",s=1,o={};if(void 0!=this.renderHtmlFunction){var u=function(e,t,n){var r="<<ASYNC"+Math.random()+">>",a=null;return s++,this.asyncRenderHtml(e,t,n,function(e,t){o[r]=t,a=t,i()}),null!==a?(delete o[r],a):r};a=this.renderHtmlFunction(e,r(t))}i()},enhance:function(e,t,n){return null!=this.renderFunction&&this.renderFunction(e,t,n),this},update:function(e,t,n,i){var a;return a=void 0!=this.updateFunction?this.updateFunction(e,t,n,i):this.defaultUpdate(e,t,n,i),a&&r(function(){this.render(e,t,n)}.bind(this)),this},action:function(e,t){var n=function(){for(var t=[];t.length<arguments.length;)t[t.length]=arguments[t.length];for(var n=e;n;){if(n.renderer){var r=n.renderer.linkHandler.apply(n.renderer,[n.data,n].concat(t));if(r===!1)return r}n=n.parent}};if("function"==typeof this.actionFunction){g.addLinkHandler(n);var r=this.actionFunction.apply(this,arguments);return g.removeLinkHandler(n),r}g.log(g.logLevel.WARNING,"Renderer "+this.name+" has no actions (attempted "+t+")")},canRender:function(e,t,n){return void 0!=this.filterFunction?this.filterFunction(e,t,n):!0},defaultUpdate:function(e,t,n,r){var i=!1,a="replace"!=r.action(),s=t.pointerPath();return r.subjectEquals(s)||a&&r.subjectChild(s)!==!1?i=!0:void 0!=r.target()&&(r.targetEquals(s)||a&&r.targetChild(s)!==!1)&&(i=!0),i},saveUiState:function(e,t){var n={};for(key in e)n[key]=e[key];for(var r in t)for(var i in t[r])n[r+"-"+i]=t[r][i];for(key in n)g.isData(n[key])&&(n[key]=this.saveStateData(n[key]));return n},saveStateData:function(e){return e?e.document.isDefinitive?"url:"+e.referenceUrl():(e.saveStateId=e.saveStateId||n(),o.saveData(e,e.saveStateId)||e.saveStateId):void 0},loadUiState:function(e){var t={},n={};for(var r in e)if(-1!=r.indexOf("-")){var i=r.split("-"),a=i.shift(),s=i.join("-");n[a]||(n[a]={}),n[a][s]=e[r]}else t[r]=this.loadStateData(e[r])||e[r],g.isRequest(t[r])&&function(e){t[e].getData(function(n){t[e]=n})}(r);return[t,n]},loadStateData:function(e){if(!e||"string"!=typeof e)return void 0;if("url:"==e.substring(0,4)){var t=e.substring(4),n=null,r=g.getData(t,function(e){n=e});return n||r}var n=o.loadData(e);return n&&(n.saveStateId=e),n}},d.prototype.super_=d.prototype;var L={},I={undefined:{},"null":{},"boolean":{},integer:{},number:{},string:{},object:{},array:{}},T={undefined:{},"null":{},"boolean":{},integer:{},number:{},string:{},object:{},array:{}};if(o.register=f,o.deregister=p,"undefined"!=typeof document){var R=[document];o.addDocument=function(e){return R.push(e),this},o.removeDocument=function(e){var t=R.indexOf(e);return-1!==t&&R.splice(t,1),this},o.getElementById=function(e){for(var t=0;t<R.length;t++){var n=R[t].getElementById(e);if(n)return n}return null}}var V=[];if(o.addActionHandler=function(e){V.push(e)},"undefined"!=typeof e.jQuery){var A=function(e,t){var n=this[0];return void 0!=n&&o(n,e,t),this};g.extendData({$renderTo:function(e,t){"string"==typeof e&&(e=jQuery(e));var n=e[0];void 0!=n&&o(n,this,t)}}),A.register=function(e){if(void 0!=e.render){var t=e.render;e.render=function(e,n){var r=$(e);t.call(this,r,n)}}if(void 0!=e.update){var n=e.update;e.update=function(e,t,r){var i=$(e);n.call(this,i,t,r)}}o.register(e)},jQuery.fn.extend({renderJson:A}),jQuery.extend({renderJson:A})}g.extend({render:o,renderHtml:u,enhance:h,renderValue:l,asyncRenderHtml:c}),g.extendData({renderTo:function(e,t){"string"==typeof e&&(e=o.getElementById(e)),o(e,this,t)}}),g.invalidate=function(e){return function(){var t=e.apply(this,arguments),n=[];for(var r in C.elementLookup){var i=C.elementLookup[r];n=n.concat(i)}for(var a=0;a<n.length;a++){var s=o.getElementById(n[a]);s&&s.jsonaryContext&&s.jsonaryContext.data.document.access()}return t}}(g.invalidate)}(this);var Jsonary=this.Jsonary,baseSchema={id:"http://json-schema.org/draft-04/schema#",$schema:"http://json-schema.org/draft-04/schema#",title:"JSON Schema",description:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},positiveInteger:{type:"integer",minimum:0},positiveIntegerDefault0:{allOf:[{$ref:"#/definitions/positiveInteger"},{"default":0}]},simpleTypes:{title:"Simple type","enum":["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},minItems:1,uniqueItems:!0}},type:"object",properties:{id:{type:"string",format:"uri"},$schema:{type:"string",format:"uri"},title:{type:"string"},description:{type:"string"},"default":{},multipleOf:{type:"number",minimum:0,exclusiveMinimum:!0},maximum:{type:"number"},exclusiveMaximum:{type:"boolean","default":!1},minimum:{type:"number"},exclusiveMinimum:{type:"boolean","default":!1},maxLength:{$ref:"#/definitions/positiveInteger"},minLength:{$ref:"#/definitions/positiveIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{oneOf:[{type:"boolean"},{$ref:"#"}],"default":{}},items:{oneOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],"default":{}},maxItems:{$ref:"#/definitions/positiveInteger"},minItems:{$ref:"#/definitions/positiveIntegerDefault0"},uniqueItems:{type:"boolean","default":!1},maxProperties:{$ref:"#/definitions/positiveInteger"},minProperties:{$ref:"#/definitions/positiveIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{oneOf:[{type:"boolean"},{$ref:"#"}],"default":{}},definitions:{type:"object",additionalProperties:{$ref:"#"},"default":{}},properties:{type:"object",additionalProperties:{$ref:"#"},"default":{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},"default":{}},dependencies:{type:"object",additionalProperties:{oneOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},"enum":{type:"array",minItems:1,uniqueItems:!0},type:{oneOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},dependencies:{exclusiveMaximum:["maximum"],exclusiveMinimum:["minimum"]},"default":{}},hyperSchema={$schema:"http://json-schema.org/draft-04/hyper-schema#",id:"http://json-schema.org/draft-04/hyper-schema#",title:"JSON Hyper-Schema",allOf:[{$ref:"http://json-schema.org/draft-04/schema#"}],properties:{additionalItems:{oneOf:[{type:"boolean"},{$ref:"#"}]},additionalProperties:{oneOf:[{type:"boolean"},{$ref:"#"}]},dependencies:{additionalProperties:{oneOf:[{$ref:"#"},{type:"array"}]}},items:{oneOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}]},definitions:{additionalProperties:{$ref:"#"}},patternProperties:{additionalProperties:{$ref:"#"}},properties:{additionalProperties:{$ref:"#"}},allOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"},links:{type:"array",items:{$ref:"#/definitions/linkDescription"}},fragmentResolution:{type:"string"},media:{type:"object",properties:{type:{description:"A media type, as described in RFC 2046",type:"string"},binaryEncoding:{description:"A content encoding scheme, as described in RFC 2045",type:"string"}}},pathStart:{description:"Instances' URIs must start with this value for this schema to apply to them",type:"string",format:"uri"}},definitions:{schemaArray:{title:"Array of schemas",type:"array",items:{$ref:"#"}},linkDescription:{title:"Link Description Object",type:"object",required:["href","rel"],properties:{href:{description:"a URI template, as defined by RFC 6570, with the addition of the $, ( and ) characters for pre-processing",type:"string"},rel:{description:"relation to the target resource of the link",type:"string"},title:{description:"a title for the link",type:"string"},targetSchema:{description:"JSON Schema describing the link target",$ref:"#"},mediaType:{description:"media type (as defined by RFC 2046) describing the link target",type:"string"},method:{description:'method for requesting the target of the link (e.g. for HTTP this might be "GET" or "DELETE")',type:"string"},encType:{description:"The media type in which to submit data along with the request",type:"string","default":"application/json"},schema:{description:"Schema describing the data to submit along with the request",$ref:"#"}}}},links:[{rel:"self",href:"{+id}"},{rel:"full",href:"{+($ref)}"}]};return Jsonary.addToCache("http://json-schema.org/schema",{allOf:[{$ref:"draft-04/schema"}]}),Jsonary.addToCache("http://json-schema.org/draft-04/schema",baseSchema),Jsonary.addToCache("http://json-schema.org/hyper-schema",{allOf:[{$ref:"draft-04/hyper-schema"}]}),Jsonary.addToCache("http://json-schema.org/draft-04/hyper-schema",hyperSchema),function(e){e.render.Components.add("LIST_LINKS"),e.render.register({name:"Jsonary list links with prompt",component:e.render.Components.LIST_LINKS,update:function(){return!1},renderHtml:function(t,n){if(!t.readOnly())return n.renderHtml(t);var r="";if(n.uiState.editInPlace){var i='<span class="button action">save</span>';r+=n.actionHtml(i,"submit");var i='<span class="button action">cancel</span>';return r+=n.actionHtml(i,"cancel"),r+=n.withSameComponents().renderHtml(n.uiState.submissionData,"~linkData")}var a=t.links();if(a.length){r+='<span class="link-list">';for(var s=0;s<a.length;s++){var o=a[s];if("self"!=o.rel){var i='<span class="button link">'+e.escapeHtml(o.title||o.rel)+"</span>";r+=n.actionHtml(i,"follow-link",s)}}r+="</span>"}if(void 0!=n.uiState.submitLink){var o=t.links()[n.uiState.submitLink];r+='<div class="prompt-outer"><div class="prompt-inner">',r+=n.actionHtml('<div class="prompt-overlay"></div>',"cancel"),r+='<div class="prompt-box"><h1>'+e.escapeHtml(o.title||o.rel)+"</h1><h2>"+e.escapeHtml(o.method)+" "+e.escapeHtml(o.href)+"</h2>",r+="<div>"+n.renderHtml(n.uiState.submissionData,"~linkData")+"</div>",r+="</div>",r+='<div class="prompt-buttons">',r+=n.actionHtml('<span class="button">Submit</span>',"submit"),r+=n.actionHtml('<span class="button">cancel</span>',"cancel"),r+="</div>",r+="</div></div>"}return r+=n.renderHtml(t,"data")},action:function(e,t,n){if("follow-link"==t){var r=e.data,i=r.links()[n];if("GET"==i.method&&0==i.submissionSchemas.length)return i.follow(),!1;if(e.uiState.submitLink=n,e.uiState.submissionData=i.createSubmissionData(void 0,!0),"PUT"==i.method){var a=r.getLink("self")&&r.getLink("self").href||r.referenceUrl()||"";i.href.replace(/#$/,"")===a.replace(/#$/,"")&&(e.uiState.editInPlace=!0)}return!0}if("submit"==t){var i=e.data.links()[e.uiState.submitLink];return i.follow(e.uiState.submissionData),delete e.uiState.submitLink,delete e.uiState.editInPlace,delete e.uiState.submissionData,!0
}return delete e.uiState.submitLink,delete e.uiState.editInPlace,delete e.uiState.submissionData,!0},saveState:function(e,t){var n={};for(var r in t.data)n[r]=t.data[r];if(void 0!=n.link||void 0!=n.inPlace||void 0!=n.linkData||void 0!=n[""]){var i={"":"-"};for(var r in n)i["-"+r]=n[r];n=i}if(void 0!==e.submitLink){var a=[e.submitLink];a.push(e.editInPlace?1:0),a.push(this.saveStateData(e.submissionData)),n.link=a.join("-")}return n},loadState:function(e){var t={};if(void 0!=e.link){var n=e.link.split("-");t.submitLink=parseInt(n.shift())||0,parseInt(n.shift())&&(t.editInPlace=!0),t.submissionData=this.loadStateData(n.join("-")),delete e.link,t.submissionData||(t={})}if("-"!=e[""]){delete e[""];var r={};for(var i in e){var a="-"==i.charAt(0)?i.substring(1):i;r[a]=e[i]}e=r}return[t,{data:e}]}})}(Jsonary),function(e){function t(e){for(var n="",r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(1==i.nodeType){var a=i.tagName.toLowerCase();if("br"==a){n+="\n";continue}"li"==i.tagName&&(n+="\n*	"),("p"==a||/^h[0-6]$/.test(a)||"header"==a||"aside"==a||"blockquote"==a||"footer"==a||"div"==a||"table"==a||"hr"==a)&&""!=n&&(n+="\n"),("td"==a||"th"==a)&&(n+="	"),n+=t(i),"tr"==a&&(n+="\n")}else 3==i.nodeType&&(n+=i.nodeValue)}return n=n.replace(/\r\n/g,"\n"),n=n.replace(/\n$/,""),n=n.replace(/\u00A0/g," ")}var n=Jsonary.escapeHtml;void 0==e.escapeHtml&&(e.escapeHtml=n),Jsonary.render.register({name:"Jsonary plain add/remove",component:Jsonary.render.Components.ADD_REMOVE,renderHtml:function(e,t){if(!e.defined()){t.uiState.undefined=!0;var n=e.schemas(!0);if(n.readOnly())return"";var r=n.title();return!r&&e.parent()&&"object"==e.parent().basicType()&&(r=e.parentKey()),r=r||"add",t.actionHtml('<span class="json-undefined-create">+ '+Jsonary.escapeHtml(r)+"</span>","create")}delete t.uiState.undefined;var i=!1;if(null!=e.parent()){var a=e.parent();if("object"==a.basicType()){var s=a.schemas().requiredProperties(),o=a.schemas().minProperties();i=-1==s.indexOf(e.parentKey())&&a.keys().length>o}else if("array"==a.basicType()){var u=a.schemas().tupleTypingLength(),h=a.schemas().minItems(),l=parseInt(e.parentKey());(l>=u||l==a.length()-1)&&a.length()>h&&(i=!0)}}var c="";if(i){var d=a.basicType();c+="<div class='json-"+d+"-delete-container'>",c+=t.actionHtml("<span class='json-"+d+"-delete json-"+d+"-delete-inner'>X</span>","remove")+" ",c+=t.renderHtml(e,"data"),c+="</div>"}else c+=t.renderHtml(e,"data");return c},action:function(e,t){if("create"==t){var n=e.data,r=n.parent(),i=n.parentKey();if(void 0!=r){var a=r.schemas();"array"==r.basicType()?a.createValueForIndex(i,function(e){r.index(i).setValue(e)}):("object"!=r.basicType()&&r.setValue({}),a.createValueForProperty(i,function(e){r.property(i).setValue(e)}))}else n.schemas().createValue(function(e){n.setValue(e)})}else"remove"==t?e.data.remove():alert("Unkown action: "+t)},update:function(e,t,n){return t.defined()==!!n.uiState.undefined},filter:{readOnly:!1},saveState:function(e,t){return t.data||{}},loadState:function(e){return[{},{data:e}]}}),Jsonary.render.register({name:"Jsonary plain type-selector",component:Jsonary.render.Components.TYPE_SELECTOR,renderHtml:function(e,t){var n="",r=e.schemas().enumValues(),i=e.schemas().basicTypes();if(i.length>1&&null==r){n+='<select name="'+t.inputNameForAction("select-basic-type")+'">';for(var a=0;a<i.length;a++)if("integer"!=i[a]||-1==i.indexOf("number")){var s=Jsonary.escapeHtml(i[a]);n+=i[a]==e.basicType()||"number"==i[a]&&"integer"==e.basicType()?'<option value="'+s+'" selected>'+s+"</option>":'<option value="'+s+'">'+s+"</option>"}n+="</select> "}return n+=t.renderHtml(e,"data")},action:function(e,t,n){if("select-basic-type"==t){e.uiState.dialogOpen=!1;var r=e.data.schemas().concat([Jsonary.createSchema({type:n})]),i=e.data.get();return r.createValue(i,function(t){e.data.setValue(t)}),!0}alert("Unkown action: "+t)},update:function(){return!1},filter:{readOnly:!1},saveState:function(e,t){var n={};if(e.dialogOpen&&(n.dialogOpen=!0),!t.data||void 0==t.data._&&void 0==t.data.dialogOpen)for(var r in t.data)n[r]=t.data[r];else n._=t.data;return n},loadState:function(e){var t=e,n={};if(void 0!=e._){var n=e._;delete e._}else{var t={};e.dialogOpen&&(t.dialogOpen=!0),delete e.dialogOpen,n=e}return[t,{data:n}]}}),Jsonary.render.Components.add("SCHEMA_SWITCHER",Jsonary.render.Components.TYPE_SELECTOR),Jsonary.render.register({name:"Jsonary plain schema-switcher",component:Jsonary.render.Components.SCHEMA_SWITCHER,renderHtml:function(e,t){var n,r="",i=e.schemas().fixed(),a=!1,s=i.orSchemas();if(0==s.length&&(n=i.xorSchemas(),1==n.length&&(a=!0)),t.uiState.xorSelected=[],t.uiState.orSelected=[],a)for(var o=0;o<n.length;o++){var u=n[o],h=t.inputNameForAction("selectXorSchema",o);r+='<select name="'+h+'">';for(var l=0;l<u.length;l++){var c=u[l];c.getFull(function(e){c=e});var d="";-1!=e.schemas().indexOf(c)&&(t.uiState.xorSelected[o]=l,d=" selected"),r+='<option value="'+l+'"'+d+">"+c.forceTitle()+"</option>"}r+="</select>"}if(t.uiState.dialogOpen){r+='<div class="json-select-type-dialog-outer"><span class="json-select-type-dialog">',r+=t.actionHtml("close","closeDialog"),n=n||i.xorSchemas();for(var o=0;o<n.length;o++){var u=n[o],h=t.inputNameForAction("selectXorSchema",o);r+='<br><select name="'+h+'">';for(var l=0;l<u.length;l++){var c=u[l];c.getFull(function(e){c=e});var d="";-1!=e.schemas().indexOf(c)&&(t.uiState.xorSelected[o]=l,d=" selected"),r+='<option value="'+l+'"'+d+">"+c.title()+"</option>"}r+="</select>"}for(var o=0;o<s.length;o++){var u=s[o],h=t.inputNameForAction("selectOrSchema",o);r+='<br><select name="'+h+'" multiple size="'+u.length+'">',t.uiState.orSelected[o]=[];for(var l=0;l<u.length;l++){var c=u[l];c.getFull(function(e){c=e});var d="";-1!=e.schemas().indexOf(c)?(t.uiState.orSelected[o][l]=!0,d=" selected"):t.uiState.orSelected[o][l]=!1,r+='<option value="'+l+'"'+d+">"+c.title()+"</option>"}r+="</select>"}r+="</span></div>"}return!a&&i.length<e.schemas().length&&(r+=t.actionHtml('<span class="json-select-type button">Schemas</span>',"openDialog")+" "),r+=t.renderHtml(e,"data")},createValue:function(e){for(var t=e.data,n=e.data.schemas().fixed(),r=e.data.schemas().fixed().xorSchemas(),i=0;i<r.length;i++)n=n.concat([r[i][e.uiState.xorSelected[i]].getFull()]);for(var a=e.data.schemas().fixed().orSchemas(),i=0;i<a.length;i++)for(var s=a[i],o=0;o<s.length;o++)e.uiState.orSelected[i][o]&&(n=n.concat([s[o].getFull()]));n=n.getFull();var u=t.get();t.setValue(n.createValue(u)),n.createValue(u,function(e){t.setValue(e)})},action:function(e,t,n,r){if("closeDialog"==t)return e.uiState.dialogOpen=!1,!0;if("openDialog"==t)return e.uiState.dialogOpen=!0,!0;if("selectXorSchema"==t){if(e.uiState.xorSelected[r]+""!=n+"")return e.uiState.xorSelected[r]=n,this.createValue(e),!0}else if("selectOrSchema"==t){for(var i=e.uiState.orSelected[r].length!==n.length,a=0;!i&&a<n.length;a++)i=e.uiState.orSelected[r][a]+""==n[a]+"";if(i){e.uiState.orSelected[r]=[];for(var a=0;a<n.length;a++)e.uiState.orSelected[r][n[a]]=!0;return this.createValue(e),!0}}else alert("Unkown action: "+t)},update:function(){return!1},filter:{readOnly:!1},saveState:function(e,t){var n={};if(e.dialogOpen&&(n.dialogOpen=!0),void 0!=t.data._||void 0!=t.data.dialogOpen)n._=t.data;else for(var r in t.data)n[r]=t.data[r];return n},loadState:function(e){var t=e,n={};if(void 0!=e._){var n=e._;delete e._}else{var t={};e.dialogOpen&&(t.dialogOpen=!0),delete e.dialogOpen,n=e}return[t,{data:n}]}}),Jsonary.render.register({name:"Jsonary plain raw JSON display",renderHtml:function(e){return e.defined()?'<span class="json-raw">'+n(JSON.stringify(e.value()))+"</span>":""}}),Jsonary.render.register({name:"Jsonary plain null",renderHtml:function(){return'<span class="json-null">null</span>'},filter:{type:"null"}}),Jsonary.render.register({name:"Jsonary plain objects",renderHtml:function(e,t){t.uiState;var r="";r+='<fieldset class="json-object-outer">';var i=e.schemas().title();i&&(r+='<legend class="json-object-title">'+Jsonary.escapeHtml(i)+"</legend>"),r+='<table class="json-object"><tbody>';var a=function(e,i){if(i.defined())var a=i.schemas().fixed().title();else{var s=i.parent().schemas().propertySchemas(i.parentKey());if(s.readOnly())return;var a=s.title()}r+='<tr class="json-object-pair">',r+=""==a?'<td class="json-object-key"><div class="json-object-key-title">'+n(e)+"</div></td>":'<td class="json-object-key"><div class="json-object-key-title">'+n(e)+'</div><div class="json-object-key-text">'+n(a)+"</div></td>",r+='<td class="json-object-value">'+t.renderHtml(i)+"</td>",r+="</tr>"};if(e.readOnly()){var s=e.schemas().knownProperties();e.properties(s,function(e,t){t.defined()&&a(e,t)},!0)}else{var o=e.schemas(),s=o.knownProperties(),u=s.length-o.requiredProperties().length>5,h=o.maxProperties(),l=null==h||h>o.keys().length;if(e.properties(s,function(e,t){(!u&&l||t.defined())&&a(e,t)},a),l&&(o.allowedAdditionalProperties()||u))if(t.uiState.addInput){if(r+='<tr class="json-object-pair"><td class="json-object-key"><div class="json-object-key-text">',r+=t.actionHtml('<span class="button">add</span>',"add-confirm"),r+="<br>",r+="</div></td><td>",u){var c=[];e.properties(s,function(e,t){t.defined()||c.push(e)}),r+='<select name="'+t.inputNameForAction("select-preset")+'">',o.allowedAdditionalProperties()&&(r+='<option value="custom">Enter your own:</option>'),r+='<optgroup label="Known properties">',c.sort();for(var d=0;d<c.length;d++){var f=c[d];r+=f==t.uiState.addInputSelect?'<option value="key-'+Jsonary.escapeHtml(f)+'" selected>'+Jsonary.escapeHtml(f)+"</option>":'<option value="key-'+Jsonary.escapeHtml(f)+'">'+Jsonary.escapeHtml(f)+"</option>"}r+="</optgroup></select>"}!o.allowedAdditionalProperties()||u&&null!=t.uiState.addInputSelect?r+=t.actionHtml('<span class="button">cancel</span>',"add-cancel"):(r+='<input type="text" class="json-object-add-input" name="'+t.inputNameForAction("add-input")+'" value="'+Jsonary.escapeHtml(t.uiState.addInputValue)+'"></input>',r+=t.actionHtml('<span class="button">cancel</span>',"add-cancel"),e.property(t.uiState.addInputValue).defined()&&(r+='<span class="warning"><code>'+Jsonary.escapeHtml(t.uiState.addInputValue)+"</code> already exists</span>")),r+="</td></tr>"}else r+='<tr class="json-object-pair"><td class="json-object-key"><div class="json-object-key-text">',r+=t.actionHtml('<span class="button">add</span>',"add-input"),r+="</div></td><td></td></tr>"}return r+="</table>",r+="</fieldset>"},action:function(e,t,n){var r=e.data;if("select-preset"==t){if("custom"==n)delete e.uiState.addInputSelect;else{var i=n;e.uiState.addInputSelect=i.substring(4)}return!0}if("add-input"==t)return e.uiState.addInput=!0,e.uiState.addInputValue=void 0==n?"key":n,!0;if("add-cancel"==t)return delete e.uiState.addInput,delete e.uiState.addInputValue,delete e.uiState.addInputSelect,!0;if("add-confirm"==t){var i=null!=e.uiState.addInputSelect?e.uiState.addInputSelect:e.uiState.addInputValue;null==i||r.property(i).defined()||(delete e.uiState.addInput,delete e.uiState.addInputValue,delete e.uiState.addInputSelect,r.schemas().createValueForProperty(i,function(e){r.property(i).setValue(e)}))}},filter:{type:"object"}}),Jsonary.render.register({name:"Jsonary re-orderable array",renderHtml:function(e,t){var n=e.schemas().tupleTypingLength(),r=e.schemas().maxItems(),i="",a=!e.readOnly()&&e.length()>n+1;return e.items(function(e,r){i+='<div class="json-array-item">',a&&e>=n&&(i+="undefined"==typeof t.uiState.moveSelect?t.actionHtml('<span class="json-array-move json-array-move-start">move</span>',"moveStart",e):t.uiState.moveSelect==e?t.actionHtml('<span class="json-array-move json-array-move-cancel">cancel</span>',"moveCancel"):t.uiState.moveSelect>e?t.actionHtml('<span class="json-array-move json-array-move-up">to here</span>',"moveSelect",t.uiState.moveSelect,e):t.actionHtml('<span class="json-array-move json-array-move-down">to here</span>',"moveSelect",t.uiState.moveSelect,e)),i+='<span class="json-array-value">'+t.renderHtml(r)+"</span>",i+="</div>"}),e.readOnly()||(null==r||e.length()<r)&&(i+='<div class="json-array-item">',i+=t.renderHtml(e.item(e.length())),i+="</div>"),i},action:{moveStart:function(e,t,n){return t.uiState.moveSelect=n,!0},moveCancel:function(e,t){return delete t.uiState.moveSelect,!0},moveSelect:function(e,t,n,r){delete t.uiState.moveSelect,e.item(n).moveTo(e.item(r))}},update:function(e,t,n,r){return void 0!=n.uiState.moveSelect?(delete n.uiState.moveSelect,!0):this.defaultUpdate(e,t,n,r)},filter:{type:"array"}}),Jsonary.render.register({name:"Jsonary plain display string",renderHtml:function(e){return'<span class="json-string">'+n(e.value())+"</span>"},filter:{type:"string",readOnly:!0}}),Jsonary.render.register({name:"Jsonary plain edit string",renderHtml:function(e,t){e.schemas().maxLength();for(var r=t.inputNameForAction("new-value"),i=n(e.value()),a=0,s=e.value().split("\n"),o=0;o<s.length;o++)a+=Math.floor(s[o].length/70)+1;return'<textarea class="json-string" rows="'+a+'" name="'+r+'">'+i+"</textarea>"},action:function(e,t,n){"new-value"==t&&e.data.setValue(n)},render:function(e,r){if(null!==e.contentEditable){e.innerHTML='<div class="json-string json-string-content-editable">'+n(r.value()).replace(/\n/g,"<br>")+"</div>";var i=e.childNodes[0];return i.contentEditable="true",i.onblur=function(){var e=t(i);r.setValue(e)},void 0}},update:function(e,t,r,i){if(null!==e.contentEditable){var a=e.childNodes[0];return a.innerHTML=n(t.value()).replace(/\n/g,"<br>"),!1}if("replace"==i.action()){for(var s=null,o=0;o<e.childNodes.length;o++)if("textarea"==e.childNodes[o].tagName.toLowerCase()){s=e.childNodes[o];break}return s.value=t.value(),s.onkeyup(),!1}return!0},filter:{type:"string",readOnly:!1}}),Jsonary.render.register({name:"Jsonary plain booleans",renderHtml:function(e,t){if(e.readOnly())return e.value()?'<span class="json-boolean-true">yes</span>':'<span class="json-boolean-false">no</span>';var n=t.inputNameForAction("switch");return'<input type="checkbox" class="json-boolean" name="'+n+'" value="1" '+(e.value()?"checked":"")+"></input>"},action:function(e,t,n){"switch"==t&&e.data.setValue(!!n)},filter:{type:"boolean"}}),Jsonary.render.register({name:"Jsonary plain edit number",renderHtml:function(e,t){var n="";if(e.value().toString().length>3){var r=e.value().toString().length;n='style="width: '+r+'em;"'}var i='<input class="json-number-input" type="text" value="'+e.value()+'" name="'+t.inputNameForAction("input")+'" '+n+"></input>",a=e.schemas().numberInterval();if(void 0!=a){var s=e.schemas().minimum();i=null==s||e.value()>s+a||e.value()==s+a&&!e.schemas().exclusiveMinimum()?t.actionHtml('<span class="json-number-decrement button">-</span>',"decrement")+i:'<span class="json-number-decrement button disabled" onmousedown="event.preventDefault();">-</span>'+i;var o=e.schemas().maximum();i+=null==o||e.value()<o-a||e.value()==o-a&&!e.schemas().exclusiveMaximum()?t.actionHtml('<span class="json-number-increment button">+</span>',"increment"):'<span class="json-number-increment button disabled" onmousedown="event.preventDefault;">+</span>'}return'<span class="json-number">'+i+"</span>"},action:function(e,t,n){var r=e.data,i=r.schemas().numberInterval();if("increment"==t){var a=r.value()+i,s=!0,o=r.schemas().maximum();void 0!=o&&(a>o||a==o&&r.schemas().exclusiveMaximum())&&(s=!1),s&&r.setValue(a)}else if("decrement"==t){var a=r.value()-i,s=!0,u=r.schemas().minimum();void 0!=u&&(u>a||a==u&&r.schemas().exclusiveMinimum())&&(s=!1),s&&r.setValue(a)}else if("input"==t){var h=n,a=parseFloat(h);if(!isNaN(a)){void 0!=i&&(a=Math.round(a/i)*i);var s=!0,u=r.schemas().minimum();void 0!=u&&(u>a||a==u&&r.schemas().exclusiveMinimum())&&(s=!1);var o=r.schemas().maximum();void 0!=o&&(a>o||a==o&&r.schemas().exclusiveMaximum())&&(s=!1),s||(a=r.schemas().createValueNumber()),r.setValue(a)}}},filter:{type:["number","integer"],readOnly:!1}}),Jsonary.render.register({name:"Jsonary plain enums",render:function(e,t){var r=t.schemas().enumValues();if(0==r.length)return e.innerHTML='<span class="json-enum-invalid">invalid</span>',void 0;if(1!=r.length){for(var i=document.createElement("select"),a=0;a<r.length;a++){var s=document.createElement("option");s.setAttribute("value",a),t.equals(Jsonary.create(r[a]))&&(s.selected=!0),s.appendChild(document.createTextNode(r[a])),i.appendChild(s)}i.onchange=function(){var e=this.value;t.setValue(r[e])},e.appendChild(i),e=i=s=null}else if("string"==typeof r[0])e.innerHTML='<span class="json-string">'+n(r[0])+"</span>";else if("number"==typeof r[0])e.innerHTML='<span class="json-number">'+r[0]+"</span>";else if("boolean"==typeof r[0]){var o=r[0]?"true":"false";e.innerHTML='<span class="json-boolean-'+o+'">'+o+"</span>"}else e.innerHTML='<span class="json-raw">'+n(JSON.stringify(r[0]))+"</span>"},filter:{readOnly:!1,filter:function(e,t){return null!=t.enumValues()}}})}(this),function(){Jsonary.render.register({renderHtml:function(e){var t=new Date(e.value());return isNaN(t.getTime())?'<span class="json-string json-string-date">'+Jsonary.escapeHtml(e.value())+"</span>":'<span class="json-string json-string-date">'+t.toLocaleString()+"</span>"},filter:{type:"string",readOnly:!0,filter:function(e,t){return-1!=t.formats().indexOf("date-time")}}}),Jsonary.render.register({renderHtml:function(e,t){if(e.readOnly())return t.uiState.showPassword?Jsonary.escapeHtml(e.value()):t.actionHtml("(show password)","show-password");var n=t.inputNameForAction("update");return'<input type="password" name="'+n+'" value="'+Jsonary.escapeHtml(e.value())+'"></input>'},action:function(e,t,n){return"show-password"==t?(e.uiState.showPassword=!0,!0):("update"==t&&e.data.setValue(n),void 0)},filter:{type:"string",filter:function(e,t){return-1!=t.formats().indexOf("password")}}})}(),this}.call(this);